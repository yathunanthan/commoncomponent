import { Component, Output, EventEmitter, Input } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "../serivces/common-payment.service";
import * as i2 from "./payment-bank-details/payment-bank-details.component";
import * as i3 from "./payment-card-details/payment-card-details.component";
import * as i4 from "../payment-complete/payment-complete.component";
import * as i5 from "@angular/common";
export class PaymentDetailsComponent {
    constructor(commonService) {
        this.commonService = commonService;
        this.paymentMethodType = 'Bank transfer';
        this.devicePayment = false;
        this.testResult = "testResult";
        this.total = 0;
        this.paymentMethodAllowed = 3;
        this.paymentMethod = 1;
        this.paymentCompleted = true;
        this.canDoWalletPay = false;
        this.walletPayLogoName = '';
        this.walletPayDesc = '';
        this.emitter = new EventEmitter();
        this.payEmitter = new EventEmitter();
        this.payOptionEmitter = new EventEmitter();
    }
    valid(paymentEnable) {
        this.paymentEnable = paymentEnable;
        this.payEmitter.emit(paymentEnable);
    }
    ngOnInit() {
        var _a, _b, _c, _d, _e;
        this.commonService.userUrl$.subscribe((res) => {
            this.portalName = res === null || res === void 0 ? void 0 : res.portal;
        });
        this.commonService.paymentDetails$.subscribe((response) => {
            this.genericPaymentDetails = response;
        });
        console.log('paymentSelectedOptions', this.paymentSelectedOptions);
        console.log('portalname', this.portalName);
        console.log('statemtn', this.genericPaymentDetails);
        if (((_a = this.commonService.apiUrl) === null || _a === void 0 ? void 0 : _a.portal) == 'InvoicePortal') {
            this.amountToBePaid = this.genericPaymentDetails.paymentDetails.amountToBePaid;
            this.pendingAmount = this.genericPaymentDetails.paymentDetails.pendingAmount;
            this.paymentCompleted = (this.amountToBePaid - this.genericPaymentDetails.paymentDetails.pendingAmount) < 1;
            this.paymentMethod = this.genericPaymentDetails.isGocardlessEnabled && this.genericPaymentDetails.customerDetails.postcode ? 1 : (this.genericPaymentDetails.cardIntegration && this.genericPaymentDetails.cardCharges != -1 && (this.genericPaymentDetails.isBasysEnabled || this.genericPaymentDetails.isPayFortEnabled || this.genericPaymentDetails.isStripeEnabled || this.genericPaymentDetails.isWorldPayEnbled) && (!this.settings.cardEnable || this.settings.cardEnable == 'Always' || this.genericPaymentDetails.invoiceDetails.total + this.genericPaymentDetails.invoiceDetails.taxes + this.genericPaymentDetails.invoiceDetails.total * (this.tip / 100) + (this.genericPaymentDetails.cardCharges[this.genericPaymentDetails.cardCharges].charge / 100) * (this.genericPaymentDetails.invoiceDetails.total + this.genericPaymentDetails.invoiceDetails.taxes + this.genericPaymentDetails.invoiceDetails.total * (this.tip / 100)) <= this.settings.creditDebitCard)) ? 2 : 0;
            this.clientTelephone = this.genericPaymentDetails.clientDetails.countrycode + this.genericPaymentDetails.clientDetails.telephone;
        }
        else if (((_b = this.commonService.apiUrl) === null || _b === void 0 ? void 0 : _b.portal) == 'StatementPortal') {
            this.paymentMethod = this.genericPaymentDetails.isGocardlessEnabled && this.genericPaymentDetails.customerDetails.postcode ? 1 : (this.genericPaymentDetails.cardIntegration && (this.genericPaymentDetails.isStripeEnabled || this.genericPaymentDetails.isWorldPayEnbled || this.genericPaymentDetails.isPayFort) && (this.settings.cardEnable == undefined || (this.settings.cardEnable != 'No' && (this.settings.cardEnable == 'Always' || this.total <= this.settings.creditDebitCard)))) ? 2 : 0;
            this.clientTelephone = this.genericPaymentDetails.client_telephone;
        }
        this.isGocardlessEnabled = this.genericPaymentDetails.isGocardlessEnabled;
        this.postCode = ((_d = (_c = this.genericPaymentDetails) === null || _c === void 0 ? void 0 : _c.customerDetails) === null || _d === void 0 ? void 0 : _d.postcode) ? (_e = this.genericPaymentDetails) === null || _e === void 0 ? void 0 : _e.customerDetails.postcode : this.genericPaymentDetails['postcode'];
        this.commonService.setUserResponse(this.genericPaymentDetails, '');
        if ("settings" in this.genericPaymentDetails) {
            this.settings = this.genericPaymentDetails.settings.reduce((obj, item) => Object.assign(obj, { [item.key]: item.value }), {});
            this.paymentMethodType = this.settings.countryRegion == 6 ? 'ACH' : 'Bank transfer';
        }
        else {
            this.paymentMethodType = this.genericPaymentDetails.countryRegion == 6 ? 'ACH' : 'Bank transfer';
        }
        setTimeout(() => {
            this.paymentSelected(this.paymentMethod);
        }, 100);
        this.emitter.emit(this.paymentMethodType);
    }
    changePaymentOption(option, selected) {
        this.paymentOption = option;
        if (selected == true) {
            if (this.paymentOption == 'debit') {
                this.payOptionEmitter.emit('debit');
            }
            else if (this.paymentOption == 'credit') {
                this.payOptionEmitter.emit('credit');
            }
        }
    }
    paymentSelected(value) {
        var temp = this.paymentMethod != value;
        if (value > 0) {
            this.paymentMethod = value;
            this.emitter.emit(value);
            var check = document.getElementById(value);
            if (check) {
                check.checked = true;
            }
            if (temp) {
                this.payEmitter.emit(true);
            }
        }
    }
}
PaymentDetailsComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: PaymentDetailsComponent, deps: [{ token: i1.CommonPaymentService }], target: i0.ɵɵFactoryTarget.Component });
PaymentDetailsComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: PaymentDetailsComponent, selector: "lib-payment-details", inputs: { genericPaymentDetails: "genericPaymentDetails", tip: "tip", total: "total", paymentSelectedOptions: "paymentSelectedOptions" }, outputs: { emitter: "emitter", payEmitter: "payEmitter", payOptionEmitter: "payOptionEmitter" }, ngImport: i0, template: "<div class=\"row pay-body\">\n    <div class=\"pay-title-box\">\n        <div class=\"pay-title\">Payment details</div>\n        <div class=\"pay-details\">\n            <span *ngIf=\"portalName == 'InvoicePortal' && (amountToBePaid - (pendingAmount ? pendingAmount : 0)) >0\">Please fill the information below about your payment method</span>\n            <span *ngIf=\"portalName == 'StatementPortal' || portalName == 'AcceptProposal'\">Please fill the information below about your payment method</span>\n        </div>\n        <div class=\"pay-details\" *ngIf=\"portalName == 'InvoicePortal' && (amountToBePaid - (pendingAmount ? pendingAmount : 0)) <= 0\">\n            Payment status and summary information</div>\n    </div>\n    <div class=\"pay-selection\" *ngIf=\"(amountToBePaid - pendingAmount) >0 || portalName == 'StatementPortal' || portalName == 'AcceptProposal'\">\n\n        <div class=\"col pay-width\">Pay with</div>\n        <div class=\"row width-q\">\n            <div *ngIf=\"isGocardlessEnabled && postCode\" class=\"col pay-btn\" (click)=\"paymentSelected(1)\" [ngClass]=\"{'pay-btn-active' : paymentMethod == '1'}\">\n                <div *ngIf=\"portalName == 'AcceptProposal'\"><input type=\"radio\" name=\"payWith\" id=\"1\" (click)=\"changePaymentOption('debit',true)\" [checked]=\"paymentSelectedOptions=='debit'\"></div>\n                <div *ngIf=\"portalName != 'AcceptProposal'\"><input type=\"radio\" name=\"payWith\" id=\"1\"></div>\n                <span\n                    class=\"pay-btn-text\">{{paymentMethodType }}</span>\n                    <svg width=\"20\" height=\"16\" viewBox=\"0 0 20 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                        <path d=\"M13 10V7H16V5L20 8.5L16 12V10H13ZM12 3.7V5H0V3.7L6 0L12 3.7ZM5 6H7V11H5V6ZM1 6H3V11H1V6ZM11 6V8.5L9 10.3V6H11ZM7.1 12L6.5 12.5L8.2 14H0V12H7.1ZM15 11V14H12V16L8 12.5L12 9V11H15Z\" fill=\"#505B65\"/>\n                        </svg>\n                        \n            </div>\n            <div class=\"col pay-btn\" (click)=\"paymentSelected(2)\" [ngClass]=\"{'pay-btn-active' : paymentMethod == '2'}\">\n                <div *ngIf=\"portalName == 'AcceptProposal'\"><input type=\"radio\" name=\"payWith\" id=\"1\" (click)=\"changePaymentOption('credit',true)\" [checked]=\"paymentSelectedOptions=='credit'\"></div>\n                <div *ngIf=\"portalName != 'AcceptProposal'\"><input type=\"radio\" name=\"payWith\" id=\"1\"></div>\n                <span\n                    class=\"pay-btn-text\">Debit or credit card</span>\n                    <svg width=\"20\" height=\"14\" viewBox=\"0 0 20 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                      <path d=\"M17 0H3C2.20435 0 1.44129 0.316071 0.87868 0.87868C0.316071 1.44129 0 2.20435 0 3V11C0 11.7956 0.316071 12.5587 0.87868 13.1213C1.44129 13.6839 2.20435 14 3 14H17C17.7956 14 18.5587 13.6839 19.1213 13.1213C19.6839 12.5587 20 11.7956 20 11V3C20 2.20435 19.6839 1.44129 19.1213 0.87868C18.5587 0.316071 17.7956 0 17 0ZM9 10H5C4.73478 10 4.48043 9.89464 4.29289 9.70711C4.10536 9.51957 4 9.26522 4 9C4 8.73478 4.10536 8.48043 4.29289 8.29289C4.48043 8.10536 4.73478 8 5 8H9C9.26522 8 9.51957 8.10536 9.70711 8.29289C9.89464 8.48043 10 8.73478 10 9C10 9.26522 9.89464 9.51957 9.70711 9.70711C9.51957 9.89464 9.26522 10 9 10ZM15 10H13C12.7348 10 12.4804 9.89464 12.2929 9.70711C12.1054 9.51957 12 9.26522 12 9C12 8.73478 12.1054 8.48043 12.2929 8.29289C12.4804 8.10536 12.7348 8 13 8H15C15.2652 8 15.5196 8.10536 15.7071 8.29289C15.8946 8.48043 16 8.73478 16 9C16 9.26522 15.8946 9.51957 15.7071 9.70711C15.5196 9.89464 15.2652 10 15 10ZM18 4H2V3C2 2.73478 2.10536 2.48043 2.29289 2.29289C2.48043 2.10536 2.73478 2 3 2H17C17.2652 2 17.5196 2.10536 17.7071 2.29289C17.8946 2.48043 18 2.73478 18 3V4Z\" fill=\"#505B65\"/>\n                    </svg>\n                    </div>\n            <!-- <div *ngIf=\"userData.isStripeEnabled && userData.isWalletPayEnabled && canDoWalletPay\" class=\"col pay-btn\"\n                [ngClass]=\"{'pay-btn-active' : paymentMethod == '3'}\" (click)=\"paymentSelected(3)\"><input type=\"radio\"\n                    name=\"payWith\" id=\"3\"><span class=\"pay-btn-text\">{{ walletPayDesc }}</span><img\n                    class=\"icon-align\" src=\"\" alt=\"\">\n            </div> -->\n\n        </div>\n        <lib-payment-bank-details *ngIf=\"paymentMethod == '1' && isGocardlessEnabled && postCode\" [paymentTypeS]=\"paymentMethodType\" (payEmitter)=\"valid($event)\"\n            [paymentData]=\"genericPaymentDetails\"></lib-payment-bank-details>\n        <lib-payment-card-details *ngIf=\"(portalName == 'StatementPortal' && paymentMethod == '2') || (portalName == 'AcceptProposal' && paymentMethod == '2') || (portalName == 'InvoicePortal' && paymentMethod == '2' && genericPaymentDetails.cardIntegration && (genericPaymentDetails.isBasysEnabled || genericPaymentDetails.isPayFortEnabled || genericPaymentDetails.isStripeEnabled || genericPaymentDetails.isWorldPayEnbled )  && genericPaymentDetails.cardCharges.length != 0 &&  ( !settings.cardEnable || settings.cardEnable =='Always'|| genericPaymentDetails.invoiceDetails.total + genericPaymentDetails.invoiceDetails.taxes + genericPaymentDetails.invoiceDetails.total*(tip/100) <= settings.creditDebitCard))\" [cardPaymentData]=\"genericPaymentDetails\"\n            (payEmitter)=\"valid($event)\"></lib-payment-card-details>\n    </div>\n    <div class=\"(portalName == 'StatementPortal' || portalName == 'InvoicePortal') && paymentCompleted\" *ngIf=\"(amountToBePaid - pendingAmount)  <= 0\">\n        <lib-payment-complete [valid]=\"paymentCompleted\"\n            [completePageDetails]=\"genericPaymentDetails\"></lib-payment-complete>\n    </div>\n</div>\n<div class=\"row pay-body error-body\" *ngIf=\"paymentMethod == 0\">\n    <span *ngIf=\"settings.cardEnable =='Always' || total <= settings.creditDebitCard\" style=\"display: none\">\n        <span\n            *ngIf=\"paymentMethod != '0' ? '':paymentSelected((genericPaymentDetails.isGocardlessEnabled && genericPaymentDetails.customerDetails.postcode)?1:(genericPaymentDetails.cardIntegration && settings.cardEnable !='No' && (settings.cardEnable =='Always'|| total <= settings.creditDebitCard))?2:0)\"></span>\n    </span>\n    <div class=\"error-title\">\n        <div class=\"logo\"><img class=\"fa-check\" src=\"assets/icon/warning.svg\" alt=\"link-invalid\"></div>\n        <div>'We`re unable to process a payment. Please contact {{clientTelephone}}  for assistance'\n        </div>\n    </div>\n</div>", styles: [".pay-body{border:1px solid var(--primaryBorderColor);box-shadow:0 4px 8px #0000000a,0 0 2px #0000000f,0 0 1px #0000000a;border-radius:4px;margin:24px;overflow:hidden}.error-body{text-align:center;height:280px}.error-body .error-title{font-weight:700;font-size:14px;line-height:20px;color:#f2994a;padding-top:120px;padding-bottom:12px}.error-body .error-content{font-weight:400;font-size:12px;line-height:20px;color:var(--primaryTextColor)}.pay-title-box{background:var(--titleBarBackground);width:100%;padding:16px 24.5px}.pay-title{font-weight:700;font-size:16px;line-height:24px;color:var(--titleBarFontColor)}.pay-details{font-size:14px;line-height:20px;color:var(--titleBarSecondaryFontColour);padding-top:12px}.pay-selection{width:100%;padding:24px}.width-q{margin:0;grid-gap:24px;gap:24px}.pay-width{font-weight:700;font-size:16px;color:var(--primaryTextColor);padding-bottom:8px}.pay-btn{background:#FFFFFF;border:1px solid var(--primaryBorderColor);border-radius:4px;font-size:14px;color:var(--primaryTextColor);display:flex;align-items:center;cursor:pointer;margin-bottom:0;padding-right:18px}.pay-btn-active{border:1px solid var(--secondaryButtonColour)}.pay-btn-text{font-size:14px;color:var(--primaryTextColor);padding:8px 8px 8px 16px;width:95%}.icon-align{width:20px;height:19px}.paymentCompleted{padding:0}@media (max-width: 578px){.pay-body{margin:16px 0 0;border:none;box-shadow:none;border-radius:0}.pay-title-box{padding:22px 16px}.pay-selection{padding:16px}}@media (max-width: 784px){.pay-btn{min-width:100%;padding-right:16px;padding-left:12px}.width-q{grid-gap:12px;gap:12px}.pay-width{padding-bottom:12px}.pay-details{padding-top:8px}}\n"], components: [{ type: i2.PaymentBankDetailsComponent, selector: "lib-payment-bank-details", inputs: ["paymentData", "paymentTypeS"], outputs: ["payEmitter"] }, { type: i3.PaymentCardDetailsComponent, selector: "lib-payment-card-details", inputs: ["cardPaymentData"], outputs: ["payEmitter"] }, { type: i4.PaymentCompleteComponent, selector: "lib-payment-complete", inputs: ["valid", "cardDetails", "completePageDetails"], outputs: ["close"] }], directives: [{ type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i5.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: PaymentDetailsComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'lib-payment-details',
                    templateUrl: './payment-details.component.html',
                    styleUrls: ['./payment-details.component.scss']
                }]
        }], ctorParameters: function () { return [{ type: i1.CommonPaymentService }]; }, propDecorators: { genericPaymentDetails: [{
                type: Input
            }], tip: [{
                type: Input
            }], total: [{
                type: Input
            }], paymentSelectedOptions: [{
                type: Input
            }], emitter: [{
                type: Output
            }], payEmitter: [{
                type: Output
            }], payOptionEmitter: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF5bWVudC1kZXRhaWxzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3BhcmVudHBheW1lbnQvc3JjL2xpYi9wYXltZW50LWRldGFpbHMvcGF5bWVudC1kZXRhaWxzLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3BhcmVudHBheW1lbnQvc3JjL2xpYi9wYXltZW50LWRldGFpbHMvcGF5bWVudC1kZXRhaWxzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7QUFRL0UsTUFBTSxPQUFPLHVCQUF1QjtJQW9DbEMsWUFBb0IsYUFBa0M7UUFBbEMsa0JBQWEsR0FBYixhQUFhLENBQXFCO1FBbEN0RCxzQkFBaUIsR0FBUSxlQUFlLENBQUM7UUFHekMsa0JBQWEsR0FBVSxLQUFLLENBQUM7UUFFN0IsZUFBVSxHQUFNLFlBQVksQ0FBQztRQVVwQixVQUFLLEdBQVEsQ0FBQyxDQUFDO1FBRXhCLHlCQUFvQixHQUFRLENBQUMsQ0FBQztRQUM5QixrQkFBYSxHQUFRLENBQUMsQ0FBQztRQUN2QixxQkFBZ0IsR0FBWSxJQUFJLENBQUM7UUFDakMsbUJBQWMsR0FBWSxLQUFLLENBQUM7UUFDaEMsc0JBQWlCLEdBQVcsRUFBRSxDQUFDO1FBQy9CLGtCQUFhLEdBQVcsRUFBRSxDQUFDO1FBTWpCLFlBQU8sR0FBeUIsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUMzRCxlQUFVLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDeEQscUJBQWdCLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7SUFJZCxDQUFDO0lBekIzRCxLQUFLLENBQUMsYUFBa0I7UUFDdEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDbkMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQXdCRCxRQUFROztRQUNOLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQU8sRUFBQyxFQUFFO1lBQy9DLElBQUksQ0FBQyxVQUFVLEdBQUcsR0FBRyxhQUFILEdBQUcsdUJBQUgsR0FBRyxDQUFFLE1BQU0sQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFFBQVksRUFBQyxFQUFFO1lBQzNELElBQUksQ0FBQyxxQkFBcUIsR0FBRyxRQUFRLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUE7UUFDRixPQUFPLENBQUMsR0FBRyxDQUFDLHdCQUF3QixFQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQ2xFLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMxQyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUNuRCxJQUFHLENBQUEsTUFBQSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sMENBQUUsTUFBTSxLQUFJLGVBQWUsRUFBQztZQUN0RCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDO1lBQy9FLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUE7WUFDNUUsSUFBSSxDQUFDLGdCQUFnQixHQUFHLENBQUMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM1RyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxtQkFBbUIsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFBLENBQUMsQ0FBQSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLFdBQVcsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxjQUFjLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLGdCQUFnQixJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLGdCQUFnQixDQUFFLElBQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxJQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxJQUFHLFFBQVEsSUFBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFBLENBQUMsQ0FBQSxDQUFDLENBQUEsQ0FB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LEtBQUs7Z0JBQ0csS0FBSztzQkFBYixLQUFLO2dCQUNHLHNCQUFzQjtzQkFBOUIsS0FBSztnQkFZSSxPQUFPO3NCQUFoQixNQUFNO2dCQUNHLFVBQVU7c0JBQW5CLE1BQU07Z0JBQ0csZ0JBQWdCO3NCQUF6QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29tbW9uUGF5bWVudFNlcnZpY2UgfSBmcm9tICcuLi9zZXJpdmNlcy9jb21tb24tcGF5bWVudC5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbGliLXBheW1lbnQtZGV0YWlscycsXG4gIHRlbXBsYXRlVXJsOiAnLi9wYXltZW50LWRldGFpbHMuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9wYXltZW50LWRldGFpbHMuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBQYXltZW50RGV0YWlsc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgcGF5bWVudE1ldGhvZFR5cGU6IGFueSA9ICdCYW5rIHRyYW5zZmVyJztcbiAgcGF5bWVudEVuYWJsZTogYW55O1xuICBzZXR0aW5nczogYW55O1xuICBkZXZpY2VQYXltZW50OiBib29sZWFuPWZhbHNlO1xuICBjbGllbnRUZWxlcGhvbmU6IGFueTtcbiAgdGVzdFJlc3VsdDogYW55PVwidGVzdFJlc3VsdFwiO1xuICBwb3N0Q29kZTogYW55O1xuICBpc0dvY2FyZGxlc3NFbmFibGVkOiBhbnk7XG4gIHBheW1lbnRPcHRpb246IGFueTtcbiAgdmFsaWQocGF5bWVudEVuYWJsZTogYW55KSB7XG4gICAgdGhpcy5wYXltZW50RW5hYmxlID0gcGF5bWVudEVuYWJsZTtcbiAgICB0aGlzLnBheUVtaXR0ZXIuZW1pdChwYXltZW50RW5hYmxlKTtcbiAgfVxuICBASW5wdXQoKSBnZW5lcmljUGF5bWVudERldGFpbHM6YW55O1xuICBASW5wdXQoKSB0aXA6IGFueTtcbiAgQElucHV0KCkgdG90YWw6bnVtYmVyPTA7XG4gIEBJbnB1dCgpIHBheW1lbnRTZWxlY3RlZE9wdGlvbnM6YW55O1xuICBwYXltZW50TWV0aG9kQWxsb3dlZDogYW55ID0gMztcbiAgcGF5bWVudE1ldGhvZDogYW55ID0gMTtcbiAgcGF5bWVudENvbXBsZXRlZDogYm9vbGVhbiA9IHRydWU7XG4gIGNhbkRvV2FsbGV0UGF5OiBib29sZWFuID0gZmFsc2U7XG4gIHdhbGxldFBheUxvZ29OYW1lOiBzdHJpbmcgPSAnJztcbiAgd2FsbGV0UGF5RGVzYzogc3RyaW5nID0gJyc7XG4gIHdhbGxldERldGFpbHM6IGFueTtcbiAgYW1vdW50VG9CZVBhaWQ6YW55O1xuICBwZW5kaW5nQW1vdW50OmFueTtcbiAgcG9ydGFsTmFtZTphbnk7XG5cbiAgQE91dHB1dCgpIGVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG4gIEBPdXRwdXQoKSBwYXlFbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgcGF5T3B0aW9uRW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuXG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjb21tb25TZXJ2aWNlOkNvbW1vblBheW1lbnRTZXJ2aWNlKSB7IH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHsgICAgXG4gICAgdGhpcy5jb21tb25TZXJ2aWNlLnVzZXJVcmwkLnN1YnNjcmliZSgocmVzOmFueSk9PntcbiAgICAgIHRoaXMucG9ydGFsTmFtZSA9IHJlcz8ucG9ydGFsO1xuICAgIH0pO1xuICAgIHRoaXMuY29tbW9uU2VydmljZS5wYXltZW50RGV0YWlscyQuc3Vic2NyaWJlKChyZXNwb25zZTphbnkpPT57XG4gICAgICB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscyA9IHJlc3BvbnNlO1xuICAgIH0pXG4gICAgY29uc29sZS5sb2coJ3BheW1lbnRTZWxlY3RlZE9wdGlvbnMnLHRoaXMucGF5bWVudFNlbGVjdGVkT3B0aW9ucyk7XG4gICAgY29uc29sZS5sb2coJ3BvcnRhbG5hbWUnLHRoaXMucG9ydGFsTmFtZSk7XG4gICAgY29uc29sZS5sb2coJ3N0YXRlbXRuJyx0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscyk7XG4gICAgaWYodGhpcy5jb21tb25TZXJ2aWNlLmFwaVVybD8ucG9ydGFsID09ICdJbnZvaWNlUG9ydGFsJyl7XG4gICAgICB0aGlzLmFtb3VudFRvQmVQYWlkID0gdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMucGF5bWVudERldGFpbHMuYW1vdW50VG9CZVBhaWQ7XG4gICAgICB0aGlzLnBlbmRpbmdBbW91bnQgPSB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5wYXltZW50RGV0YWlscy5wZW5kaW5nQW1vdW50XG4gICAgICB0aGlzLnBheW1lbnRDb21wbGV0ZWQgPSAodGhpcy5hbW91bnRUb0JlUGFpZCAtIHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLnBheW1lbnREZXRhaWxzLnBlbmRpbmdBbW91bnQpIDwgMTtcbiAgICAgIHRoaXMucGF5bWVudE1ldGhvZCA9IHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmlzR29jYXJkbGVzc0VuYWJsZWQgJiYgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuY3VzdG9tZXJEZXRhaWxzLnBvc3Rjb2RlID8xOih0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5jYXJkSW50ZWdyYXRpb24gJiYgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuY2FyZENoYXJnZXMgIT0gLTEgJiYgKHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmlzQmFzeXNFbmFibGVkIHx8IHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmlzUGF5Rm9ydEVuYWJsZWQgfHwgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaXNTdHJpcGVFbmFibGVkIHx8IHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmlzV29ybGRQYXlFbmJsZWQgKSAgICYmICAoIXRoaXMuc2V0dGluZ3MuY2FyZEVuYWJsZXx8IHRoaXMuc2V0dGluZ3MuY2FyZEVuYWJsZSA9PSdBbHdheXMnfHwgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaW52b2ljZURldGFpbHMudG90YWwgKyB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5pbnZvaWNlRGV0YWlscy50YXhlcyArIHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmludm9pY2VEZXRhaWxzLnRvdGFsKih0aGlzLnRpcC8xMDApICsgKHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmNhcmRDaGFyZ2VzW3RoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmNhcmRDaGFyZ2VzXS5jaGFyZ2UgLyAxMDApICogKHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmludm9pY2VEZXRhaWxzLnRvdGFsICsgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaW52b2ljZURldGFpbHMudGF4ZXMgKyB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5pbnZvaWNlRGV0YWlscy50b3RhbCoodGhpcy50aXAvMTAwKSkgPD0gdGhpcy5zZXR0aW5ncy5jcmVkaXREZWJpdENhcmQpKT8yOjA7XG4gICAgICB0aGlzLmNsaWVudFRlbGVwaG9uZSA9IHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmNsaWVudERldGFpbHMuY291bnRyeWNvZGUgKyB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5jbGllbnREZXRhaWxzLnRlbGVwaG9uZTtcbiAgICB9ZWxzZSBpZih0aGlzLmNvbW1vblNlcnZpY2UuYXBpVXJsPy5wb3J0YWwgPT0gJ1N0YXRlbWVudFBvcnRhbCcpe1xuICAgICAgdGhpcy5wYXltZW50TWV0aG9kID0gdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaXNHb2NhcmRsZXNzRW5hYmxlZCAmJiB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5jdXN0b21lckRldGFpbHMucG9zdGNvZGU/MToodGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuY2FyZEludGVncmF0aW9uICYmICh0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5pc1N0cmlwZUVuYWJsZWQgfHwgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaXNXb3JsZFBheUVuYmxlZCB8fCB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5pc1BheUZvcnQpICYmICh0aGlzLnNldHRpbmdzLmNhcmRFbmFibGUgPT0gdW5kZWZpbmVkIHx8KHRoaXMuc2V0dGluZ3MuY2FyZEVuYWJsZSAhPSdObycgJiYgKHRoaXMuc2V0dGluZ3MuY2FyZEVuYWJsZSA9PSdBbHdheXMnfHwgdGhpcy50b3RhbCA8PSB0aGlzLnNldHRpbmdzLmNyZWRpdERlYml0Q2FyZCkpKSk/MjowO1xuICAgICAgdGhpcy5jbGllbnRUZWxlcGhvbmUgPSB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5jbGllbnRfdGVsZXBob25lXG4gICAgfVxuICAgIHRoaXMuaXNHb2NhcmRsZXNzRW5hYmxlZCA9IHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmlzR29jYXJkbGVzc0VuYWJsZWQ7XG4gICAgdGhpcy5wb3N0Q29kZSA9IHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzPy5jdXN0b21lckRldGFpbHM/LnBvc3Rjb2RlID8gdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHM/LmN1c3RvbWVyRGV0YWlscy5wb3N0Y29kZSA6IHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzWydwb3N0Y29kZSddO1xuICAgIHRoaXMuY29tbW9uU2VydmljZS5zZXRVc2VyUmVzcG9uc2UodGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMsJycpO1xuICAgIFxuICAgIGlmKFwic2V0dGluZ3NcIiBpbiB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscyl7XG4gICAgICB0aGlzLnNldHRpbmdzID0gdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuc2V0dGluZ3MucmVkdWNlKChvYmo6IGFueSwgaXRlbTogYW55KSA9PiBPYmplY3QuYXNzaWduKG9iaiwgeyBbaXRlbS5rZXldOiBpdGVtLnZhbHVlIH0pLCB7fSk7XG4gICAgICB0aGlzLnBheW1lbnRNZXRob2RUeXBlID0gdGhpcy5zZXR0aW5ncy5jb3VudHJ5UmVnaW9uPT0gNiA/ICdBQ0gnIDogJ0JhbmsgdHJhbnNmZXInO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5wYXltZW50TWV0aG9kVHlwZSA9IHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmNvdW50cnlSZWdpb24gPT0gNiA/ICdBQ0gnIDogJ0JhbmsgdHJhbnNmZXInO1xuICAgIH1cbiAgICBcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMucGF5bWVudFNlbGVjdGVkKHRoaXMucGF5bWVudE1ldGhvZClcbiAgICB9LCAxMDApO1xuICAgIHRoaXMuZW1pdHRlci5lbWl0KHRoaXMucGF5bWVudE1ldGhvZFR5cGUpO1xuICAgIFxuICAgIFxuICB9XG5cbiAgY2hhbmdlUGF5bWVudE9wdGlvbihvcHRpb24gOiBzdHJpbmcsc2VsZWN0ZWQ6YW55KXtcbiAgICB0aGlzLnBheW1lbnRPcHRpb24gPSBvcHRpb247XG4gICAgaWYgKHNlbGVjdGVkID09IHRydWUpe1xuICAgICAgaWYodGhpcy5wYXltZW50T3B0aW9uID09ICdkZWJpdCcpe1xuICAgICAgICB0aGlzLnBheU9wdGlvbkVtaXR0ZXIuZW1pdCgnZGViaXQnKTtcbiAgICAgIH1lbHNlIGlmKHRoaXMucGF5bWVudE9wdGlvbiA9PSAnY3JlZGl0Jyl7IFxuICAgICAgICB0aGlzLnBheU9wdGlvbkVtaXR0ZXIuZW1pdCgnY3JlZGl0Jyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcGF5bWVudFNlbGVjdGVkKHZhbHVlOiBhbnkpIHtcbiAgICB2YXIgdGVtcCA9IHRoaXMucGF5bWVudE1ldGhvZCAhPSB2YWx1ZVxuICAgIGlmICh2YWx1ZSA+IDApIHtcbiAgICAgICAgdGhpcy5wYXltZW50TWV0aG9kID0gdmFsdWU7XG4gICAgICAgIHRoaXMuZW1pdHRlci5lbWl0KHZhbHVlKTtcbiAgICAgICAgdmFyIGNoZWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodmFsdWUpIGFzIEhUTUxJbnB1dEVsZW1lbnRcbiAgICAgICAgaWYgKGNoZWNrKSB7XG4gICAgICAgICAgICBjaGVjay5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGVtcCkge1xuICAgICAgICAgICAgdGhpcy5wYXlFbWl0dGVyLmVtaXQodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbn1cbiIsIjxkaXYgY2xhc3M9XCJyb3cgcGF5LWJvZHlcIj5cbiAgICA8ZGl2IGNsYXNzPVwicGF5LXRpdGxlLWJveFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwicGF5LXRpdGxlXCI+UGF5bWVudCBkZXRhaWxzPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJwYXktZGV0YWlsc1wiPlxuICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJwb3J0YWxOYW1lID09ICdJbnZvaWNlUG9ydGFsJyAmJiAoYW1vdW50VG9CZVBhaWQgLSAocGVuZGluZ0Ftb3VudCA/IHBlbmRpbmdBbW91bnQgOiAwKSkgPjBcIj5QbGVhc2UgZmlsbCB0aGUgaW5mb3JtYXRpb24gYmVsb3cgYWJvdXQgeW91ciBwYXltZW50IG1ldGhvZDwvc3Bhbj5cbiAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwicG9ydGFsTmFtZSA9PSAnU3RhdGVtZW50UG9ydGFsJyB8fCBwb3J0YWxOYW1lID09ICdBY2NlcHRQcm9wb3NhbCdcIj5QbGVhc2UgZmlsbCB0aGUgaW5mb3JtYXRpb24gYmVsb3cgYWJvdXQgeW91ciBwYXltZW50IG1ldGhvZDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJwYXktZGV0YWlsc1wiICpuZ0lmPVwicG9ydGFsTmFtZSA9PSAnSW52b2ljZVBvcnRhbCcgJiYgKGFtb3VudFRvQmVQYWlkIC0gKHBlbmRpbmdBbW91bnQgPyBwZW5kaW5nQW1vdW50IDogMCkpIDw9IDBcIj5cbiAgICAgICAgICAgIFBheW1lbnQgc3RhdHVzIGFuZCBzdW1tYXJ5IGluZm9ybWF0aW9uPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInBheS1zZWxlY3Rpb25cIiAqbmdJZj1cIihhbW91bnRUb0JlUGFpZCAtIHBlbmRpbmdBbW91bnQpID4wIHx8IHBvcnRhbE5hbWUgPT0gJ1N0YXRlbWVudFBvcnRhbCcgfHwgcG9ydGFsTmFtZSA9PSAnQWNjZXB0UHJvcG9zYWwnXCI+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbCBwYXktd2lkdGhcIj5QYXkgd2l0aDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93IHdpZHRoLXFcIj5cbiAgICAgICAgICAgIDxkaXYgKm5nSWY9XCJpc0dvY2FyZGxlc3NFbmFibGVkICYmIHBvc3RDb2RlXCIgY2xhc3M9XCJjb2wgcGF5LWJ0blwiIChjbGljayk9XCJwYXltZW50U2VsZWN0ZWQoMSlcIiBbbmdDbGFzc109XCJ7J3BheS1idG4tYWN0aXZlJyA6IHBheW1lbnRNZXRob2QgPT0gJzEnfVwiPlxuICAgICAgICAgICAgICAgIDxkaXYgKm5nSWY9XCJwb3J0YWxOYW1lID09ICdBY2NlcHRQcm9wb3NhbCdcIj48aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInBheVdpdGhcIiBpZD1cIjFcIiAoY2xpY2spPVwiY2hhbmdlUGF5bWVudE9wdGlvbignZGViaXQnLHRydWUpXCIgW2NoZWNrZWRdPVwicGF5bWVudFNlbGVjdGVkT3B0aW9ucz09J2RlYml0J1wiPjwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgKm5nSWY9XCJwb3J0YWxOYW1lICE9ICdBY2NlcHRQcm9wb3NhbCdcIj48aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInBheVdpdGhcIiBpZD1cIjFcIj48L2Rpdj5cbiAgICAgICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cInBheS1idG4tdGV4dFwiPnt7cGF5bWVudE1ldGhvZFR5cGUgfX08L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDxzdmcgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjE2XCIgdmlld0JveD1cIjAgMCAyMCAxNlwiIGZpbGw9XCJub25lXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD1cIk0xMyAxMFY3SDE2VjVMMjAgOC41TDE2IDEyVjEwSDEzWk0xMiAzLjdWNUgwVjMuN0w2IDBMMTIgMy43Wk01IDZIN1YxMUg1VjZaTTEgNkgzVjExSDFWNlpNMTEgNlY4LjVMOSAxMC4zVjZIMTFaTTcuMSAxMkw2LjUgMTIuNUw4LjIgMTRIMFYxMkg3LjFaTTE1IDExVjE0SDEyVjE2TDggMTIuNUwxMiA5VjExSDE1WlwiIGZpbGw9XCIjNTA1QjY1XCIvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbCBwYXktYnRuXCIgKGNsaWNrKT1cInBheW1lbnRTZWxlY3RlZCgyKVwiIFtuZ0NsYXNzXT1cInsncGF5LWJ0bi1hY3RpdmUnIDogcGF5bWVudE1ldGhvZCA9PSAnMid9XCI+XG4gICAgICAgICAgICAgICAgPGRpdiAqbmdJZj1cInBvcnRhbE5hbWUgPT0gJ0FjY2VwdFByb3Bvc2FsJ1wiPjxpbnB1dCB0eXBlPVwicmFkaW9cIiBuYW1lPVwicGF5V2l0aFwiIGlkPVwiMVwiIChjbGljayk9XCJjaGFuZ2VQYXltZW50T3B0aW9uKCdjcmVkaXQnLHRydWUpXCIgW2NoZWNrZWRdPVwicGF5bWVudFNlbGVjdGVkT3B0aW9ucz09J2NyZWRpdCdcIj48L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVwicG9ydGFsTmFtZSAhPSAnQWNjZXB0UHJvcG9zYWwnXCI+PGlucHV0IHR5cGU9XCJyYWRpb1wiIG5hbWU9XCJwYXlXaXRoXCIgaWQ9XCIxXCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJwYXktYnRuLXRleHRcIj5EZWJpdCBvciBjcmVkaXQgY2FyZDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHN2ZyB3aWR0aD1cIjIwXCIgaGVpZ2h0PVwiMTRcIiB2aWV3Qm94PVwiMCAwIDIwIDE0XCIgZmlsbD1cIm5vbmVcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI+XG4gICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD1cIk0xNyAwSDNDMi4yMDQzNSAwIDEuNDQxMjkgMC4zMTYwNzEgMC44Nzg2OCAwLjg3ODY4QzAuMzE2MDcxIDEuNDQxMjkgMCAyLjIwNDM1IDAgM1YxMUMwIDExLjc5NTYgMC4zMTYwNzEgMTIuNTU4NyAwLjg3ODY4IDEzLjEyMTNDMS40NDEyOSAxMy42ODM5IDIuMjA0MzUgMTQgMyAxNEgxN0MxNy43OTU2IDE0IDE4LjU1ODcgMTMuNjgzOSAxOS4xMjEzIDEzLjEyMTNDMTkuNjgzOSAxMi41NTg3IDIwIDExLjc5NTYgMjAgMTFWM0MyMCAyLjIwNDM1IDE5LjY4MzkgMS40NDEyOSAxOS4xMjEzIDAuODc4NjhDMTguNTU4NyAwLjMxNjA3MSAxNy43OTU2IDAgMTcgMFpNOSAxMEg1QzQuNzM0NzggMTAgNC40ODA0MyA5Ljg5NDY0IDQuMjkyODkgOS43MDcxMUM0LjEwNTM2IDkuNTE5NTcgNCA5LjI2NTIyIDQgOUM0IDguNzM0NzggNC4xMDUzNiA4LjQ4MDQzIDQuMjkyODkgOC4yOTI4OUM0LjQ4MDQzIDguMTA1MzYgNC43MzQ3OCA4IDUgOEg5QzkuMjY1MjIgOCA5LjUxOTU3IDguMTA1MzYgOS43MDcxMSA4LjI5Mjg5QzkuODk0NjQgOC40ODA0MyAxMCA4LjczNDc4IDEwIDlDMTAgOS4yNjUyMiA5Ljg5NDY0IDkuNTE5NTcgOS43MDcxMSA5LjcwNzExQzkuNTE5NTcgOS44OTQ2NCA5LjI2NTIyIDEwIDkgMTBaTTE1IDEwSDEzQzEyLjczNDggMTAgMTIuNDgwNCA5Ljg5NDY0IDEyLjI5MjkgOS43MDcxMUMxMi4xMDU0IDkuNTE5NTcgMTIgOS4yNjUyMiAxMiA5QzEyIDguNzM0NzggMTIuMTA1NCA4LjQ4MDQzIDEyLjI5MjkgOC4yOTI4OUMxMi40ODA0IDguMTA1MzYgMTIuNzM0OCA4IDEzIDhIMTVDMTUuMjY1MiA4IDE1LjUxOTYgOC4xMDUzNiAxNS43MDcxIDguMjkyODlDMTUuODk0NiA4LjQ4MDQzIDE2IDguNzM0NzggMTYgOUMxNiA5LjI2NTIyIDE1Ljg5NDYgOS41MTk1NyAxNS43MDcxIDkuNzA3MTFDMTUuNTE5NiA5Ljg5NDY0IDE1LjI2NTIgMTAgMTUgMTBaTTE4IDRIMlYzQzIgMi43MzQ3OCAyLjEwNTM2IDIuNDgwNDMgMi4yOTI4OSAyLjI5Mjg5QzIuNDgwNDMgMi4xMDUzNiAyLjczNDc4IDIgMyAySDE3QzE3LjI2NTIgMiAxNy41MTk2IDIuMTA1MzYgMTcuNzA3MSAyLjI5Mjg5QzE3Ljg5NDYgMi40ODA0MyAxOCAyLjczNDc4IDE4IDNWNFpcIiBmaWxsPVwiIzUwNUI2NVwiLz5cbiAgICAgICAgICAgICAgICAgICAgPC9zdmc+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPCEtLSA8ZGl2ICpuZ0lmPVwidXNlckRhdGEuaXNTdHJpcGVFbmFibGVkICYmIHVzZXJEYXRhLmlzV2FsbGV0UGF5RW5hYmxlZCAmJiBjYW5Eb1dhbGxldFBheVwiIGNsYXNzPVwiY29sIHBheS1idG5cIlxuICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cInsncGF5LWJ0bi1hY3RpdmUnIDogcGF5bWVudE1ldGhvZCA9PSAnMyd9XCIgKGNsaWNrKT1cInBheW1lbnRTZWxlY3RlZCgzKVwiPjxpbnB1dCB0eXBlPVwicmFkaW9cIlxuICAgICAgICAgICAgICAgICAgICBuYW1lPVwicGF5V2l0aFwiIGlkPVwiM1wiPjxzcGFuIGNsYXNzPVwicGF5LWJ0bi10ZXh0XCI+e3sgd2FsbGV0UGF5RGVzYyB9fTwvc3Bhbj48aW1nXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiaWNvbi1hbGlnblwiIHNyYz1cIlwiIGFsdD1cIlwiPlxuICAgICAgICAgICAgPC9kaXY+IC0tPlxuXG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8bGliLXBheW1lbnQtYmFuay1kZXRhaWxzICpuZ0lmPVwicGF5bWVudE1ldGhvZCA9PSAnMScgJiYgaXNHb2NhcmRsZXNzRW5hYmxlZCAmJiBwb3N0Q29kZVwiIFtwYXltZW50VHlwZVNdPVwicGF5bWVudE1ldGhvZFR5cGVcIiAocGF5RW1pdHRlcik9XCJ2YWxpZCgkZXZlbnQpXCJcbiAgICAgICAgICAgIFtwYXltZW50RGF0YV09XCJnZW5lcmljUGF5bWVudERldGFpbHNcIj48L2xpYi1wYXltZW50LWJhbmstZGV0YWlscz5cbiAgICAgICAgPGxpYi1wYXltZW50LWNhcmQtZGV0YWlscyAqbmdJZj1cIihwb3J0YWxOYW1lID09ICdTdGF0ZW1lbnRQb3J0YWwnICYmIHBheW1lbnRNZXRob2QgPT0gJzInKSB8fCAocG9ydGFsTmFtZSA9PSAnQWNjZXB0UHJvcG9zYWwnICYmIHBheW1lbnRNZXRob2QgPT0gJzInKSB8fCAocG9ydGFsTmFtZSA9PSAnSW52b2ljZVBvcnRhbCcgJiYgcGF5bWVudE1ldGhvZCA9PSAnMicgJiYgZ2VuZXJpY1BheW1lbnREZXRhaWxzLmNhcmRJbnRlZ3JhdGlvbiAmJiAoZ2VuZXJpY1BheW1lbnREZXRhaWxzLmlzQmFzeXNFbmFibGVkIHx8IGdlbmVyaWNQYXltZW50RGV0YWlscy5pc1BheUZvcnRFbmFibGVkIHx8IGdlbmVyaWNQYXltZW50RGV0YWlscy5pc1N0cmlwZUVuYWJsZWQgfHwgZ2VuZXJpY1BheW1lbnREZXRhaWxzLmlzV29ybGRQYXlFbmJsZWQgKSAgJiYgZ2VuZXJpY1BheW1lbnREZXRhaWxzLmNhcmRDaGFyZ2VzLmxlbmd0aCAhPSAwICYmICAoICFzZXR0aW5ncy5jYXJkRW5hYmxlIHx8IHNldHRpbmdzLmNhcmRFbmFibGUgPT0nQWx3YXlzJ3x8IGdlbmVyaWNQYXltZW50RGV0YWlscy5pbnZvaWNlRGV0YWlscy50b3RhbCArIGdlbmVyaWNQYXltZW50RGV0YWlscy5pbnZvaWNlRGV0YWlscy50YXhlcyArIGdlbmVyaWNQYXltZW50RGV0YWlscy5pbnZvaWNlRGV0YWlscy50b3RhbCoodGlwLzEwMCkgPD0gc2V0dGluZ3MuY3JlZGl0RGViaXRDYXJkKSlcIiBbY2FyZFBheW1lbnREYXRhXT1cImdlbmVyaWNQYXltZW50RGV0YWlsc1wiXG4gICAgICAgICAgICAocGF5RW1pdHRlcik9XCJ2YWxpZCgkZXZlbnQpXCI+PC9saWItcGF5bWVudC1jYXJkLWRldGFpbHM+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cIihwb3J0YWxOYW1lID09ICdTdGF0ZW1lbnRQb3J0YWwnIHx8IHBvcnRhbE5hbWUgPT0gJ0ludm9pY2VQb3J0YWwnKSAmJiBwYXltZW50Q29tcGxldGVkXCIgKm5nSWY9XCIoYW1vdW50VG9CZVBhaWQgLSBwZW5kaW5nQW1vdW50KSAgPD0gMFwiPlxuICAgICAgICA8bGliLXBheW1lbnQtY29tcGxldGUgW3ZhbGlkXT1cInBheW1lbnRDb21wbGV0ZWRcIlxuICAgICAgICAgICAgW2NvbXBsZXRlUGFnZURldGFpbHNdPVwiZ2VuZXJpY1BheW1lbnREZXRhaWxzXCI+PC9saWItcGF5bWVudC1jb21wbGV0ZT5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuPGRpdiBjbGFzcz1cInJvdyBwYXktYm9keSBlcnJvci1ib2R5XCIgKm5nSWY9XCJwYXltZW50TWV0aG9kID09IDBcIj5cbiAgICA8c3BhbiAqbmdJZj1cInNldHRpbmdzLmNhcmRFbmFibGUgPT0nQWx3YXlzJyB8fCB0b3RhbCA8PSBzZXR0aW5ncy5jcmVkaXREZWJpdENhcmRcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmVcIj5cbiAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICpuZ0lmPVwicGF5bWVudE1ldGhvZCAhPSAnMCcgPyAnJzpwYXltZW50U2VsZWN0ZWQoKGdlbmVyaWNQYXltZW50RGV0YWlscy5pc0dvY2FyZGxlc3NFbmFibGVkICYmIGdlbmVyaWNQYXltZW50RGV0YWlscy5jdXN0b21lckRldGFpbHMucG9zdGNvZGUpPzE6KGdlbmVyaWNQYXltZW50RGV0YWlscy5jYXJkSW50ZWdyYXRpb24gJiYgc2V0dGluZ3MuY2FyZEVuYWJsZSAhPSdObycgJiYgKHNldHRpbmdzLmNhcmRFbmFibGUgPT0nQWx3YXlzJ3x8IHRvdGFsIDw9IHNldHRpbmdzLmNyZWRpdERlYml0Q2FyZCkpPzI6MClcIj48L3NwYW4+XG4gICAgPC9zcGFuPlxuICAgIDxkaXYgY2xhc3M9XCJlcnJvci10aXRsZVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwibG9nb1wiPjxpbWcgY2xhc3M9XCJmYS1jaGVja1wiIHNyYz1cImFzc2V0cy9pY29uL3dhcm5pbmcuc3ZnXCIgYWx0PVwibGluay1pbnZhbGlkXCI+PC9kaXY+XG4gICAgICAgIDxkaXY+J1dlYHJlIHVuYWJsZSB0byBwcm9jZXNzIGEgcGF5bWVudC4gUGxlYXNlIGNvbnRhY3Qge3tjbGllbnRUZWxlcGhvbmV9fSAgZm9yIGFzc2lzdGFuY2UnXG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuPC9kaXY+Il19
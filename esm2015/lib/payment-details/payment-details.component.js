import { Component, Output, EventEmitter, Input } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "../serivces/common-payment.service";
import * as i2 from "./payment-bank-details/payment-bank-details.component";
import * as i3 from "./payment-card-details/payment-card-details.component";
import * as i4 from "../payment-complete/payment-complete.component";
import * as i5 from "@angular/common";
export class PaymentDetailsComponent {
    constructor(commonService) {
        this.commonService = commonService;
        this.paymentMethodType = 'Bank transfer';
        this.devicePayment = false;
        this.testResult = "testResult";
        this.total = 0;
        this.paymentMethodAllowed = 3;
        this.paymentMethod = 1;
        this.paymentCompleted = true;
        this.canDoWalletPay = false;
        this.walletPayLogoName = '';
        this.walletPayDesc = '';
        this.emitter = new EventEmitter();
        this.payEmitter = new EventEmitter();
    }
    valid(paymentEnable) {
        this.paymentEnable = paymentEnable;
        this.payEmitter.emit(paymentEnable);
    }
    ngOnInit() {
        var _a, _b, _c;
        console.log('statemtn', this.genericPaymentDetails);
        console.log('portalname', this.portalName);
        this.portalName = (_a = this.commonService.apiUrl) === null || _a === void 0 ? void 0 : _a.portal;
        if (((_b = this.commonService.apiUrl) === null || _b === void 0 ? void 0 : _b.portal) == 'InvoicePortal') {
            this.amountToBePaid = this.genericPaymentDetails.paymentDetails.amountToBePaid;
            this.pendingAmount = this.genericPaymentDetails.paymentDetails.pendingAmount;
            this.paymentCompleted = (this.amountToBePaid - this.genericPaymentDetails.paymentDetails.pendingAmount) < 1;
            this.paymentMethod = this.genericPaymentDetails.isGocardlessEnabled && this.genericPaymentDetails.customerDetails.postcode ? 1 : (this.genericPaymentDetails.cardIntegration && this.genericPaymentDetails.cardCharges != -1 && (this.genericPaymentDetails.isBasysEnabled || this.genericPaymentDetails.isPayFortEnabled || this.genericPaymentDetails.isStripeEnabled || this.genericPaymentDetails.isWorldPayEnbled) && (!this.settings.cardEnable || this.settings.cardEnable == 'Always' || this.genericPaymentDetails.invoiceDetails.total + this.genericPaymentDetails.invoiceDetails.taxes + this.genericPaymentDetails.invoiceDetails.total * (this.tip / 100) + (this.genericPaymentDetails.cardCharges[this.genericPaymentDetails.cardCharges].charge / 100) * (this.genericPaymentDetails.invoiceDetails.total + this.genericPaymentDetails.invoiceDetails.taxes + this.genericPaymentDetails.invoiceDetails.total * (this.tip / 100)) <= this.settings.creditDebitCard)) ? 2 : 0;
        }
        else if (((_c = this.commonService.apiUrl) === null || _c === void 0 ? void 0 : _c.portal) == 'StatementPortal') {
            this.paymentMethod = this.genericPaymentDetails.isGocardlessEnabled && this.genericPaymentDetails.customerDetails.postcode ? 1 : (this.genericPaymentDetails.cardIntegration && (this.genericPaymentDetails.isStripeEnabled || this.genericPaymentDetails.isWorldPayEnbled || this.genericPaymentDetails.isPayFort) && (this.settings.cardEnable == undefined || (this.settings.cardEnable != 'No' && (this.settings.cardEnable == 'Always' || this.total <= this.settings.creditDebitCard)))) ? 2 : 0;
        }
        this.commonService.setUserResponse(this.genericPaymentDetails, '');
        this.settings = this.genericPaymentDetails.settings.reduce((obj, item) => Object.assign(obj, { [item.key]: item.value }), {});
        setTimeout(() => {
            this.paymentSelected(this.paymentMethod);
        }, 100);
        this.paymentMethodType = this.settings.countryRegion == 6 ? 'ACH' : 'Bank transfer';
        this.emitter.emit(this.paymentMethodType);
        this.clientTelephone = this.genericPaymentDetails.clientDetails.countrycode + this.genericPaymentDetails.clientDetails.telephone;
    }
    paymentSelected(value) {
        var temp = this.paymentMethod != value;
        if (value > 0) {
            this.paymentMethod = value;
            this.emitter.emit(value);
            var check = document.getElementById(value);
            if (check) {
                check.checked = true;
            }
            if (temp) {
                this.payEmitter.emit(true);
            }
        }
    }
}
PaymentDetailsComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: PaymentDetailsComponent, deps: [{ token: i1.CommonPaymentService }], target: i0.ɵɵFactoryTarget.Component });
PaymentDetailsComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: PaymentDetailsComponent, selector: "lib-payment-details", inputs: { genericPaymentDetails: "genericPaymentDetails", tip: "tip", total: "total" }, outputs: { emitter: "emitter", payEmitter: "payEmitter" }, ngImport: i0, template: "<div class=\"row pay-body\">\n    <div class=\"pay-title-box\">\n        <div class=\"pay-title\">Payment details</div>\n        <div class=\"pay-details\">\n            <span *ngIf=\"portalName == 'InvoicePortal' && (amountToBePaid - (pendingAmount ? pendingAmount : 0)) >0\">Please fill the information below about your payment method</span>\n            <span *ngIf=\"portalName == 'StatementPortal'\">Please fill the information below about your payment method</span>\n        </div>\n        <div class=\"pay-details\"\n            *ngIf=\"portalName == 'InvoicePortal' && (amountToBePaid - (pendingAmount ? pendingAmount : 0)) <= 0\">\n            Payment status and summary information</div>\n    </div>\n    <div class=\"pay-selection\"\n        *ngIf=\"(amountToBePaid - pendingAmount) >0\">\n\n        <div class=\"col pay-width\">Pay with</div>\n        <div class=\"row width-q\">\n            <div class=\"col pay-btn\" (click)=\"paymentSelected(1)\"><input type=\"radio\" name=\"payWith\" id=\"1\"><span\n                    class=\"pay-btn-text\">{{paymentMethodType }}</span>\n                <img class=\"icon-align\" src=\"assets/icon/bank-transfer.svg\" alt=\"\">\n            </div>\n            <div class=\"col pay-btn\" (click)=\"paymentSelected(2)\"><input type=\"radio\" name=\"payWith\" id=\"2\"><span\n                    class=\"pay-btn-text\">Debit or credit card</span><img class=\"icon-align\" src=\"assets/icon/card.svg\"\n                    alt=\"\"></div>\n            <!-- <div *ngIf=\"userData.isStripeEnabled && userData.isWalletPayEnabled && canDoWalletPay\" class=\"col pay-btn\"\n                [ngClass]=\"{'pay-btn-active' : paymentMethod == '3'}\" (click)=\"paymentSelected(3)\"><input type=\"radio\"\n                    name=\"payWith\" id=\"3\"><span class=\"pay-btn-text\">{{ walletPayDesc }}</span><img\n                    class=\"icon-align\" src=\"\" alt=\"\">\n            </div> -->\n\n        </div>\n        <lib-payment-bank-details\n            *ngIf=\"paymentMethod == '1' && genericPaymentDetails.isGocardlessEnabled && (genericPaymentDetails.settings.countryRegion == 6 || genericPaymentDetails.customerDetails.postcode)\"\n            [paymentTypeS]=\"paymentMethodType\" (payEmitter)=\"valid($event)\" [paymentData]=\"genericPaymentDetails\"></lib-payment-bank-details>\n        <lib-payment-card-details *ngIf=\"paymentMethod == '2'\" [cardPaymentData]=\"genericPaymentDetails\"\n            (payEmitter)=\"valid($event)\"></lib-payment-card-details>\n    </div>\n    <div class=\"paymentCompleted\"\n        *ngIf=\"(amountToBePaid - pendingAmount)  <= 0\">\n        <lib-payment-complete [valid]=\"paymentCompleted\"\n            [completePageDetails]=\"genericPaymentDetails\"></lib-payment-complete>\n    </div>\n</div>\n<div class=\"row pay-body error-body\" *ngIf=\"paymentMethod == 0\">\n    <div class=\"error-title\">\n        Oops. Sorry, we are unable to process your payment.\n    </div>\n    <div class=\"error-content\">\n        An error has occurred while attempting to process your order. Please try again or try another payment method.\n    </div>\n</div>", styles: [".pay-body{border:1px solid var(--primaryBorderColor);box-shadow:0 4px 8px #0000000a,0 0 2px #0000000f,0 0 1px #0000000a;border-radius:4px;margin:24px;overflow:hidden}.error-body{text-align:center;height:280px}.error-body .error-title{font-weight:700;font-size:14px;line-height:20px;color:#f2994a;padding-top:120px;padding-bottom:12px}.error-body .error-content{font-weight:400;font-size:12px;line-height:20px;color:var(--primaryTextColor)}.pay-title-box{background:var(--titleBarBackground);width:100%;padding:16px 24.5px}.pay-title{font-weight:700;font-size:16px;line-height:24px;color:var(--titleBarFontColor)}.pay-details{font-size:14px;line-height:20px;color:var(--titleBarSecondaryFontColour);padding-top:12px}.pay-selection{width:100%;padding:24px}.width-q{margin:0;grid-gap:24px;gap:24px}.pay-width{font-weight:700;font-size:16px;color:var(--primaryTextColor);padding-bottom:8px}.pay-btn{background:#FFFFFF;border:1px solid var(--primaryBorderColor);border-radius:4px;font-size:14px;color:var(--primaryTextColor);display:flex;align-items:center;cursor:pointer;margin-bottom:0;padding-right:18px}.pay-btn-active{border:1px solid var(--secondaryButtonColour)}.pay-btn-text{font-size:14px;color:var(--primaryTextColor);padding:8px 8px 8px 16px;width:95%}.icon-align{width:20px;height:19px}.paymentCompleted{padding:0}@media (max-width: 578px){.pay-body{margin:16px 0 0;border:none;box-shadow:none;border-radius:0}.pay-title-box{padding:22px 16px}.pay-selection{padding:16px}}@media (max-width: 784px){.pay-btn{min-width:100%;padding-right:16px;padding-left:12px}.width-q{grid-gap:12px;gap:12px}.pay-width{padding-bottom:12px}.pay-details{padding-top:8px}}\n"], components: [{ type: i2.PaymentBankDetailsComponent, selector: "lib-payment-bank-details", inputs: ["paymentData", "paymentTypeS"], outputs: ["payEmitter"] }, { type: i3.PaymentCardDetailsComponent, selector: "lib-payment-card-details", inputs: ["cardPaymentData"], outputs: ["payEmitter"] }, { type: i4.PaymentCompleteComponent, selector: "lib-payment-complete", inputs: ["valid", "cardDetails", "completePageDetails"], outputs: ["close"] }], directives: [{ type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: PaymentDetailsComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'lib-payment-details',
                    templateUrl: './payment-details.component.html',
                    styleUrls: ['./payment-details.component.scss']
                }]
        }], ctorParameters: function () { return [{ type: i1.CommonPaymentService }]; }, propDecorators: { genericPaymentDetails: [{
                type: Input
            }], tip: [{
                type: Input
            }], total: [{
                type: Input
            }], emitter: [{
                type: Output
            }], payEmitter: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF5bWVudC1kZXRhaWxzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3BhcmVudHBheW1lbnQvc3JjL2xpYi9wYXltZW50LWRldGFpbHMvcGF5bWVudC1kZXRhaWxzLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3BhcmVudHBheW1lbnQvc3JjL2xpYi9wYXltZW50LWRldGFpbHMvcGF5bWVudC1kZXRhaWxzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7QUFRL0UsTUFBTSxPQUFPLHVCQUF1QjtJQStCbEMsWUFBb0IsYUFBa0M7UUFBbEMsa0JBQWEsR0FBYixhQUFhLENBQXFCO1FBN0J0RCxzQkFBaUIsR0FBUSxlQUFlLENBQUM7UUFHekMsa0JBQWEsR0FBVSxLQUFLLENBQUM7UUFFN0IsZUFBVSxHQUFNLFlBQVksQ0FBQztRQU9wQixVQUFLLEdBQVEsQ0FBQyxDQUFDO1FBQ3hCLHlCQUFvQixHQUFRLENBQUMsQ0FBQztRQUM5QixrQkFBYSxHQUFRLENBQUMsQ0FBQztRQUN2QixxQkFBZ0IsR0FBWSxJQUFJLENBQUM7UUFDakMsbUJBQWMsR0FBWSxLQUFLLENBQUM7UUFDaEMsc0JBQWlCLEdBQVcsRUFBRSxDQUFDO1FBQy9CLGtCQUFhLEdBQVcsRUFBRSxDQUFDO1FBTWpCLFlBQU8sR0FBeUIsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUMzRCxlQUFVLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7SUFJUixDQUFDO0lBdkIzRCxLQUFLLENBQUMsYUFBa0I7UUFDdEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDbkMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQXNCRCxRQUFROztRQUNOLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ25ELE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUxQyxJQUFJLENBQUMsVUFBVSxHQUFHLE1BQUEsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLDBDQUFFLE1BQU0sQ0FBQztRQUNwRCxJQUFHLENBQUEsTUFBQSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sMENBQUUsTUFBTSxLQUFJLGVBQWUsRUFBQztZQUN0RCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDO1lBQy9FLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUE7WUFDNUUsSUFBSSxDQUFDLGdCQUFnQixHQUFHLENBQUMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM1RyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxtQkFBbUIsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFBLENBQUMsQ0FBQSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLFdBQVcsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxjQUFjLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLGdCQUFnQixJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLGdCQUFnQixDQUFFLElBQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxJQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxJQUFHLFFBQVEsSUFBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFBLENBQUMsQ0FBQSxDQUFDLENBQUEsQ0FBQyxDQUFDO1NBQ2o3QjthQUFLLElBQUcsQ0FBQSxNQUFBLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSwwQ0FBRSxNQUFNLEtBQUksaUJBQWlCLEVBQUM7WUFDOUQsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsbUJBQW1CLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUEsQ0FBQyxDQUFBLENBQUMsQ0FBQSxDQUFDLENBQUEsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsZUFBZSxJQUFJLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGVBQWUsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsZ0JBQWdCLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLElBQUksU0FBUyxJQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLElBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLElBQUcsUUFBUSxJQUFHLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUEsQ0FBQyxDQUFBLENBQUMsQ0FBQSxDQUFDLENBQUM7U0FDNWQ7UUFDRCxJQUFJLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUMsRUFBRSxDQUFDLENBQUM7UUFFbEUsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQVEsRUFBRSxJQUFTLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFeEksVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFBO1FBQzFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNSLElBQUksQ0FBQyxpQkFBaUIsR0FBRSxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsSUFBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDO1FBQ2xGLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQzFDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGFBQWEsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUM7SUFFbkksQ0FBQztJQUVELGVBQWUsQ0FBQyxLQUFVO1FBQ3hCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxhQUFhLElBQUksS0FBSyxDQUFBO1FBQ3RDLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRTtZQUNYLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1lBQzNCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3pCLElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFxQixDQUFBO1lBQzlELElBQUksS0FBSyxFQUFFO2dCQUNQLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO2FBQ3hCO1lBQ0QsSUFBSSxJQUFJLEVBQUU7Z0JBQ04sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDOUI7U0FDSjtJQUNMLENBQUM7O3FIQXhFWSx1QkFBdUI7eUdBQXZCLHVCQUF1Qiw4TUNScEMsb2tHQWlETTs0RkR6Q08sdUJBQXVCO2tCQUxuQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxxQkFBcUI7b0JBQy9CLFdBQVcsRUFBRSxrQ0FBa0M7b0JBQy9DLFNBQVMsRUFBRSxDQUFDLGtDQUFrQyxDQUFDO2lCQUNoRDsyR0FhVSxxQkFBcUI7c0JBQTdCLEtBQUs7Z0JBQ0csR0FBRztzQkFBWCxLQUFLO2dCQUNHLEtBQUs7c0JBQWIsS0FBSztnQkFZSSxPQUFPO3NCQUFoQixNQUFNO2dCQUNHLFVBQVU7c0JBQW5CLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb21tb25QYXltZW50U2VydmljZSB9IGZyb20gJy4uL3Nlcml2Y2VzL2NvbW1vbi1wYXltZW50LnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdsaWItcGF5bWVudC1kZXRhaWxzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BheW1lbnQtZGV0YWlscy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3BheW1lbnQtZGV0YWlscy5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIFBheW1lbnREZXRhaWxzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBwYXltZW50TWV0aG9kVHlwZTogYW55ID0gJ0JhbmsgdHJhbnNmZXInO1xuICBwYXltZW50RW5hYmxlOiBhbnk7XG4gIHNldHRpbmdzOiBhbnk7XG4gIGRldmljZVBheW1lbnQ6IGJvb2xlYW49ZmFsc2U7XG4gIGNsaWVudFRlbGVwaG9uZTogYW55O1xuICB0ZXN0UmVzdWx0OiBhbnk9XCJ0ZXN0UmVzdWx0XCI7XG4gIHZhbGlkKHBheW1lbnRFbmFibGU6IGFueSkge1xuICAgIHRoaXMucGF5bWVudEVuYWJsZSA9IHBheW1lbnRFbmFibGU7XG4gICAgdGhpcy5wYXlFbWl0dGVyLmVtaXQocGF5bWVudEVuYWJsZSk7XG4gIH1cbiAgQElucHV0KCkgZ2VuZXJpY1BheW1lbnREZXRhaWxzOmFueTtcbiAgQElucHV0KCkgdGlwOiBhbnk7XG4gIEBJbnB1dCgpIHRvdGFsOm51bWJlcj0wO1xuICBwYXltZW50TWV0aG9kQWxsb3dlZDogYW55ID0gMztcbiAgcGF5bWVudE1ldGhvZDogYW55ID0gMTtcbiAgcGF5bWVudENvbXBsZXRlZDogYm9vbGVhbiA9IHRydWU7XG4gIGNhbkRvV2FsbGV0UGF5OiBib29sZWFuID0gZmFsc2U7XG4gIHdhbGxldFBheUxvZ29OYW1lOiBzdHJpbmcgPSAnJztcbiAgd2FsbGV0UGF5RGVzYzogc3RyaW5nID0gJyc7XG4gIHdhbGxldERldGFpbHM6IGFueTtcbiAgYW1vdW50VG9CZVBhaWQ6YW55O1xuICBwZW5kaW5nQW1vdW50OmFueTtcbiAgcG9ydGFsTmFtZTphbnk7XG5cbiAgQE91dHB1dCgpIGVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG4gIEBPdXRwdXQoKSBwYXlFbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG5cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbW1vblNlcnZpY2U6Q29tbW9uUGF5bWVudFNlcnZpY2UpIHsgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKCdzdGF0ZW10bicsdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMpO1xuICAgIGNvbnNvbGUubG9nKCdwb3J0YWxuYW1lJyx0aGlzLnBvcnRhbE5hbWUpO1xuICAgIFxuICAgIHRoaXMucG9ydGFsTmFtZSA9IHRoaXMuY29tbW9uU2VydmljZS5hcGlVcmw/LnBvcnRhbDtcbiAgICBpZih0aGlzLmNvbW1vblNlcnZpY2UuYXBpVXJsPy5wb3J0YWwgPT0gJ0ludm9pY2VQb3J0YWwnKXtcbiAgICAgIHRoaXMuYW1vdW50VG9CZVBhaWQgPSB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5wYXltZW50RGV0YWlscy5hbW91bnRUb0JlUGFpZDtcbiAgICAgIHRoaXMucGVuZGluZ0Ftb3VudCA9IHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLnBheW1lbnREZXRhaWxzLnBlbmRpbmdBbW91bnRcbiAgICAgIHRoaXMucGF5bWVudENvbXBsZXRlZCA9ICh0aGlzLmFtb3VudFRvQmVQYWlkIC0gdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMucGF5bWVudERldGFpbHMucGVuZGluZ0Ftb3VudCkgPCAxO1xuICAgICAgdGhpcy5wYXltZW50TWV0aG9kID0gdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaXNHb2NhcmRsZXNzRW5hYmxlZCAmJiB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5jdXN0b21lckRldGFpbHMucG9zdGNvZGUgPzE6KHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmNhcmRJbnRlZ3JhdGlvbiAmJiB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5jYXJkQ2hhcmdlcyAhPSAtMSAmJiAodGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaXNCYXN5c0VuYWJsZWQgfHwgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaXNQYXlGb3J0RW5hYmxlZCB8fCB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5pc1N0cmlwZUVuYWJsZWQgfHwgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaXNXb3JsZFBheUVuYmxlZCApICAgJiYgICghdGhpcy5zZXR0aW5ncy5jYXJkRW5hYmxlfHwgdGhpcy5zZXR0aW5ncy5jYXJkRW5hYmxlID09J0Fsd2F5cyd8fCB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5pbnZvaWNlRGV0YWlscy50b3RhbCArIHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmludm9pY2VEZXRhaWxzLnRheGVzICsgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaW52b2ljZURldGFpbHMudG90YWwqKHRoaXMudGlwLzEwMCkgKyAodGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuY2FyZENoYXJnZXNbdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuY2FyZENoYXJnZXNdLmNoYXJnZSAvIDEwMCkgKiAodGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaW52b2ljZURldGFpbHMudG90YWwgKyB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5pbnZvaWNlRGV0YWlscy50YXhlcyArIHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLmludm9pY2VEZXRhaWxzLnRvdGFsKih0aGlzLnRpcC8xMDApKSA8PSB0aGlzLnNldHRpbmdzLmNyZWRpdERlYml0Q2FyZCkpPzI6MDtcbiAgICB9ZWxzZSBpZih0aGlzLmNvbW1vblNlcnZpY2UuYXBpVXJsPy5wb3J0YWwgPT0gJ1N0YXRlbWVudFBvcnRhbCcpe1xuICAgICAgdGhpcy5wYXltZW50TWV0aG9kID0gdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaXNHb2NhcmRsZXNzRW5hYmxlZCAmJiB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5jdXN0b21lckRldGFpbHMucG9zdGNvZGU/MToodGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuY2FyZEludGVncmF0aW9uICYmICh0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5pc1N0cmlwZUVuYWJsZWQgfHwgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuaXNXb3JsZFBheUVuYmxlZCB8fCB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5pc1BheUZvcnQpICYmICh0aGlzLnNldHRpbmdzLmNhcmRFbmFibGUgPT0gdW5kZWZpbmVkIHx8KHRoaXMuc2V0dGluZ3MuY2FyZEVuYWJsZSAhPSdObycgJiYgKHRoaXMuc2V0dGluZ3MuY2FyZEVuYWJsZSA9PSdBbHdheXMnfHwgdGhpcy50b3RhbCA8PSB0aGlzLnNldHRpbmdzLmNyZWRpdERlYml0Q2FyZCkpKSk/MjowO1xuICAgIH1cbiAgICB0aGlzLmNvbW1vblNlcnZpY2Uuc2V0VXNlclJlc3BvbnNlKHRoaXMuZ2VuZXJpY1BheW1lbnREZXRhaWxzLCcnKTtcbiAgICBcbiAgICB0aGlzLnNldHRpbmdzID0gdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuc2V0dGluZ3MucmVkdWNlKChvYmo6IGFueSwgaXRlbTogYW55KSA9PiBPYmplY3QuYXNzaWduKG9iaiwgeyBbaXRlbS5rZXldOiBpdGVtLnZhbHVlIH0pLCB7fSk7XG4gICAgXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnBheW1lbnRTZWxlY3RlZCh0aGlzLnBheW1lbnRNZXRob2QpXG4gICAgfSwgMTAwKTtcbiAgICB0aGlzLnBheW1lbnRNZXRob2RUeXBlPSB0aGlzLnNldHRpbmdzLmNvdW50cnlSZWdpb249PSA2ID8gJ0FDSCcgOiAnQmFuayB0cmFuc2Zlcic7XG4gICAgdGhpcy5lbWl0dGVyLmVtaXQodGhpcy5wYXltZW50TWV0aG9kVHlwZSk7XG4gICAgdGhpcy5jbGllbnRUZWxlcGhvbmUgPSB0aGlzLmdlbmVyaWNQYXltZW50RGV0YWlscy5jbGllbnREZXRhaWxzLmNvdW50cnljb2RlICsgdGhpcy5nZW5lcmljUGF5bWVudERldGFpbHMuY2xpZW50RGV0YWlscy50ZWxlcGhvbmU7XG4gICAgXG4gIH1cblxuICBwYXltZW50U2VsZWN0ZWQodmFsdWU6IGFueSkge1xuICAgIHZhciB0ZW1wID0gdGhpcy5wYXltZW50TWV0aG9kICE9IHZhbHVlXG4gICAgaWYgKHZhbHVlID4gMCkge1xuICAgICAgICB0aGlzLnBheW1lbnRNZXRob2QgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5lbWl0dGVyLmVtaXQodmFsdWUpO1xuICAgICAgICB2YXIgY2hlY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh2YWx1ZSkgYXMgSFRNTElucHV0RWxlbWVudFxuICAgICAgICBpZiAoY2hlY2spIHtcbiAgICAgICAgICAgIGNoZWNrLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0ZW1wKSB7XG4gICAgICAgICAgICB0aGlzLnBheUVtaXR0ZXIuZW1pdCh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxufVxuIiwiPGRpdiBjbGFzcz1cInJvdyBwYXktYm9keVwiPlxuICAgIDxkaXYgY2xhc3M9XCJwYXktdGl0bGUtYm94XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJwYXktdGl0bGVcIj5QYXltZW50IGRldGFpbHM8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInBheS1kZXRhaWxzXCI+XG4gICAgICAgICAgICA8c3BhbiAqbmdJZj1cInBvcnRhbE5hbWUgPT0gJ0ludm9pY2VQb3J0YWwnICYmIChhbW91bnRUb0JlUGFpZCAtIChwZW5kaW5nQW1vdW50ID8gcGVuZGluZ0Ftb3VudCA6IDApKSA+MFwiPlBsZWFzZSBmaWxsIHRoZSBpbmZvcm1hdGlvbiBiZWxvdyBhYm91dCB5b3VyIHBheW1lbnQgbWV0aG9kPC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJwb3J0YWxOYW1lID09ICdTdGF0ZW1lbnRQb3J0YWwnXCI+UGxlYXNlIGZpbGwgdGhlIGluZm9ybWF0aW9uIGJlbG93IGFib3V0IHlvdXIgcGF5bWVudCBtZXRob2Q8L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwicGF5LWRldGFpbHNcIlxuICAgICAgICAgICAgKm5nSWY9XCJwb3J0YWxOYW1lID09ICdJbnZvaWNlUG9ydGFsJyAmJiAoYW1vdW50VG9CZVBhaWQgLSAocGVuZGluZ0Ftb3VudCA/IHBlbmRpbmdBbW91bnQgOiAwKSkgPD0gMFwiPlxuICAgICAgICAgICAgUGF5bWVudCBzdGF0dXMgYW5kIHN1bW1hcnkgaW5mb3JtYXRpb248L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwicGF5LXNlbGVjdGlvblwiXG4gICAgICAgICpuZ0lmPVwiKGFtb3VudFRvQmVQYWlkIC0gcGVuZGluZ0Ftb3VudCkgPjBcIj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sIHBheS13aWR0aFwiPlBheSB3aXRoPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3cgd2lkdGgtcVwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbCBwYXktYnRuXCIgKGNsaWNrKT1cInBheW1lbnRTZWxlY3RlZCgxKVwiPjxpbnB1dCB0eXBlPVwicmFkaW9cIiBuYW1lPVwicGF5V2l0aFwiIGlkPVwiMVwiPjxzcGFuXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzPVwicGF5LWJ0bi10ZXh0XCI+e3twYXltZW50TWV0aG9kVHlwZSB9fTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPVwiaWNvbi1hbGlnblwiIHNyYz1cImFzc2V0cy9pY29uL2JhbmstdHJhbnNmZXIuc3ZnXCIgYWx0PVwiXCI+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wgcGF5LWJ0blwiIChjbGljayk9XCJwYXltZW50U2VsZWN0ZWQoMilcIj48aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInBheVdpdGhcIiBpZD1cIjJcIj48c3BhblxuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cInBheS1idG4tdGV4dFwiPkRlYml0IG9yIGNyZWRpdCBjYXJkPC9zcGFuPjxpbWcgY2xhc3M9XCJpY29uLWFsaWduXCIgc3JjPVwiYXNzZXRzL2ljb24vY2FyZC5zdmdcIlxuICAgICAgICAgICAgICAgICAgICBhbHQ9XCJcIj48L2Rpdj5cbiAgICAgICAgICAgIDwhLS0gPGRpdiAqbmdJZj1cInVzZXJEYXRhLmlzU3RyaXBlRW5hYmxlZCAmJiB1c2VyRGF0YS5pc1dhbGxldFBheUVuYWJsZWQgJiYgY2FuRG9XYWxsZXRQYXlcIiBjbGFzcz1cImNvbCBwYXktYnRuXCJcbiAgICAgICAgICAgICAgICBbbmdDbGFzc109XCJ7J3BheS1idG4tYWN0aXZlJyA6IHBheW1lbnRNZXRob2QgPT0gJzMnfVwiIChjbGljayk9XCJwYXltZW50U2VsZWN0ZWQoMylcIj48aW5wdXQgdHlwZT1cInJhZGlvXCJcbiAgICAgICAgICAgICAgICAgICAgbmFtZT1cInBheVdpdGhcIiBpZD1cIjNcIj48c3BhbiBjbGFzcz1cInBheS1idG4tdGV4dFwiPnt7IHdhbGxldFBheURlc2MgfX08L3NwYW4+PGltZ1xuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cImljb24tYWxpZ25cIiBzcmM9XCJcIiBhbHQ9XCJcIj5cbiAgICAgICAgICAgIDwvZGl2PiAtLT5cblxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGxpYi1wYXltZW50LWJhbmstZGV0YWlsc1xuICAgICAgICAgICAgKm5nSWY9XCJwYXltZW50TWV0aG9kID09ICcxJyAmJiBnZW5lcmljUGF5bWVudERldGFpbHMuaXNHb2NhcmRsZXNzRW5hYmxlZCAmJiAoZ2VuZXJpY1BheW1lbnREZXRhaWxzLnNldHRpbmdzLmNvdW50cnlSZWdpb24gPT0gNiB8fCBnZW5lcmljUGF5bWVudERldGFpbHMuY3VzdG9tZXJEZXRhaWxzLnBvc3Rjb2RlKVwiXG4gICAgICAgICAgICBbcGF5bWVudFR5cGVTXT1cInBheW1lbnRNZXRob2RUeXBlXCIgKHBheUVtaXR0ZXIpPVwidmFsaWQoJGV2ZW50KVwiIFtwYXltZW50RGF0YV09XCJnZW5lcmljUGF5bWVudERldGFpbHNcIj48L2xpYi1wYXltZW50LWJhbmstZGV0YWlscz5cbiAgICAgICAgPGxpYi1wYXltZW50LWNhcmQtZGV0YWlscyAqbmdJZj1cInBheW1lbnRNZXRob2QgPT0gJzInXCIgW2NhcmRQYXltZW50RGF0YV09XCJnZW5lcmljUGF5bWVudERldGFpbHNcIlxuICAgICAgICAgICAgKHBheUVtaXR0ZXIpPVwidmFsaWQoJGV2ZW50KVwiPjwvbGliLXBheW1lbnQtY2FyZC1kZXRhaWxzPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJwYXltZW50Q29tcGxldGVkXCJcbiAgICAgICAgKm5nSWY9XCIoYW1vdW50VG9CZVBhaWQgLSBwZW5kaW5nQW1vdW50KSAgPD0gMFwiPlxuICAgICAgICA8bGliLXBheW1lbnQtY29tcGxldGUgW3ZhbGlkXT1cInBheW1lbnRDb21wbGV0ZWRcIlxuICAgICAgICAgICAgW2NvbXBsZXRlUGFnZURldGFpbHNdPVwiZ2VuZXJpY1BheW1lbnREZXRhaWxzXCI+PC9saWItcGF5bWVudC1jb21wbGV0ZT5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuPGRpdiBjbGFzcz1cInJvdyBwYXktYm9keSBlcnJvci1ib2R5XCIgKm5nSWY9XCJwYXltZW50TWV0aG9kID09IDBcIj5cbiAgICA8ZGl2IGNsYXNzPVwiZXJyb3ItdGl0bGVcIj5cbiAgICAgICAgT29wcy4gU29ycnksIHdlIGFyZSB1bmFibGUgdG8gcHJvY2VzcyB5b3VyIHBheW1lbnQuXG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImVycm9yLWNvbnRlbnRcIj5cbiAgICAgICAgQW4gZXJyb3IgaGFzIG9jY3VycmVkIHdoaWxlIGF0dGVtcHRpbmcgdG8gcHJvY2VzcyB5b3VyIG9yZGVyLiBQbGVhc2UgdHJ5IGFnYWluIG9yIHRyeSBhbm90aGVyIHBheW1lbnQgbWV0aG9kLlxuICAgIDwvZGl2PlxuPC9kaXY+Il19
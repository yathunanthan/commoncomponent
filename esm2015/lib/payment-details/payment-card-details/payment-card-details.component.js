import { Component, Input, Output, EventEmitter } from '@angular/core';
import { Validators } from '@angular/forms';
import { CreditCardValidators } from 'angular-cc-library';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@angular/common";
import * as i3 from "ngx-card";
export class PaymentCardDetailsComponent {
    constructor(fb) {
        this.fb = fb;
        this.payEmitter = new EventEmitter();
        this.storedCards = [];
        this.cardType = '';
        this.card = false;
        this.cardwidth = 350;
        this.messages = { validDate: 'valid\ndate', monthYear: 'mm/yy' }; //Strings for translation
        this.placeholders = { number: '•••• •••• •••• ••••', name: 'Full Name', expiry: '••/••', cvc: '•••' }; // Placeholders for rendered fields
        this.formatting = true;
        this.debug = true; // If true, will log helpful messages for setting up Card
        this.companyNameSelected = false;
        this.isCardNumberLength = true;
        this.cardLogo = '';
        this.cardImg = "";
    }
    ngOnInit() {
        this.payEmitter.emit(true);
    }
    dropdown(val) {
        this.cardType = false;
        this.payEmitter.emit(false);
        if (val == 'Set up new debit or credit card') {
            this.card = false;
            this.buildCreditForms();
        }
        // this.translate.get("Use existing credit card").subscribe(translations => {
        //   if(val.value== translations){
        //     this.card=true
        //     if(this.storedCards.length == 1){
        //       this.cardSelected(this.storedCards[0].id,'ts')
        //     }
        //   }
        //   else{
        //     this.card=false
        //     this.buildCreditForms()
        //   }
        // })
    }
    buildCreditForms() {
        let date = new Date().toISOString().slice(0, 10);
        this.creditForm = this.fb.group({
            payment: this.fb.group({
                'amount': [,],
                'cardCharge': [this.cardPaymentData.cardCharges['']],
                'cardName': [this.cardPaymentData.customerDetails.customerName, [Validators.required]],
                'cardNumber': ['', [Validators.required, CreditCardValidators.validateCCNumber]],
                'cardCvc': ['', [Validators.required, Validators.minLength(3), Validators.maxLength(4)]],
                'paymentDate': [date,],
                'description': ["Invoice no : " + this.cardPaymentData.invoiceDetails.invoiceNumber],
                'isportal': [true,],
                'reference': ['Invoice no : ' + this.cardPaymentData.invoiceDetails.invoiceNumber,],
                // 'invoices':[[this.cardPaymentData.invoiceDetails.invoiceNumber]],
                'email': [this.cardPaymentData.customerDetails.emailId, [Validators.required, Validators.email]],
                // 'storedCard': [0, ],
                'expiry': ['', [Validators.required, CreditCardValidators.validateExpDate]],
                // 'saveCard': [true, ],
                "paymentMethod": [this.cardPaymentData.cardCharges['']],
                "dontSendToAccounts": [''],
                // "invoices":[{'invoiceId':'1','amount':'1', 'auditSendtoaccountingsystemsid:'1'},]
            })
        });
        this.placeholders = { name: this.cardPaymentData.customerDetails.customerName ? this.cardPaymentData.customerDetails.customerName : 'Full Name' };
    }
    companyNameClick() {
        this.companyNameSelected = !this.companyNameSelected;
        this.creditForm.patchValue({ 'payment': { 'cardName': '' } });
    }
    keypress() {
        this.payEmitter.emit(this.creditForm);
    }
    setCardType() {
        this.cardLogo = this.detectCardType(this.creditForm.value.payment.cardNumber.replace(/\s/g, ""));
        var cardStatus = this.creditForm.get('payment.cardNumber');
        if (this.isCardNumberLength && (cardStatus === null || cardStatus === void 0 ? void 0 : cardStatus.status) == "INVALID")
            this.isCardNumberLength = false;
        if (!this.isCardNumberLength && (cardStatus === null || cardStatus === void 0 ? void 0 : cardStatus.status) == "VALID")
            this.isCardNumberLength = true;
        this.payEmitter.emit(this.creditForm);
        this.cardImg = "assets/paymentType/" + this.cardLogo + ".svg";
    }
    defaultCard() {
        this.cardImg = "assets/paymentType/card.svg";
    }
    cardSelected(val, from) {
        val = from == 'html' ? val.value : val;
        var storedCard = this.storedCards.find((x) => x.id == val).description;
        this.cardType = storedCard.substring(0, storedCard.indexOf('ending') - 1);
        let date = new Date().toISOString().slice(0, 10);
        this.creditForm = this.fb.group({
            'paymentDate': [date, [Validators.required]],
            'description': ["Invoice no : #" + this.cardPaymentData.invoiceDetails.invoiceNumber],
            'reference': ['Invoice no : #' + this.cardPaymentData.invoiceDetails.invoiceNumber,],
            'paymentMethod': [this.cardPaymentData.cardCharges[this.cardPaymentData.cardCharges.length - 1].paymentMethodId, [Validators.required]],
            'storedCard': [val, [Validators.required]],
            'cardName': [this.cardPaymentData.customerDetails.customerName, [Validators.required]],
            'amount': [],
            'cardCharge': [this.cardPaymentData.cardCharges[this.cardPaymentData.cardCharges.length - 1].charge,],
            'isPortal': [true],
        });
        setTimeout(() => {
            this.payEmitter.emit(this.creditForm);
        }, 100);
    }
    detectCardType(number) {
        var re = {
            electron: /^(4026|417500|4405|4508|4844|4913|4917)\d+$/,
            maestro: /^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/,
            dankort: /^(5019)\d+$/,
            interpayment: /^(636)\d+$/,
            unionpay: /^(62|88)\d+$/,
            'Visa': /^4[0-9]{12}(?:[0-9]{3})?$/,
            'MasterCard': /^5[1-5][0-9]{14}$/,
            'American Express': /^3[47][0-9]{13}$/,
            diners: /^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,
            discover: /^6(?:011|5[0-9]{2})[0-9]{12}$/,
            jcb: /^(?:2131|1800|35\d{3})\d{11}$/
        };
        for (var key in re) {
            if (re[key].test(number)) {
                return key;
            }
        }
        return false;
    }
}
PaymentCardDetailsComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: PaymentCardDetailsComponent, deps: [{ token: i1.FormBuilder }], target: i0.ɵɵFactoryTarget.Component });
PaymentCardDetailsComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: PaymentCardDetailsComponent, selector: "lib-payment-card-details", inputs: { cardPaymentData: "cardPaymentData" }, outputs: { payEmitter: "payEmitter" }, ngImport: i0, template: "<div class=\"content-group\" style=\"margin-bottom:-16px\">\n    <select (change)=\"dropdown($event.target)\">\n        <option>Use existing credit card</option>\n        <option>Set up new debit or credit card</option>\n    </select><i class=\"fa-solid fa-angle-down\"></i>\n    <div class=\"vh\"></div>\n</div>\n\n<div *ngIf=\"card\">\n    <div class=\"content-group\" style=\"margin-top:32px;margin-bottom: 0;\">\n        <div class=\"lable\">Select card</div>\n        <select (change)=\"cardSelected($event.target,'html')\">\n            <option value=\"\" disabled selected hidden>Please select</option>\n        </select><i class=\"fa-solid fa-angle-down\"></i>\n    </div>\n</div>\n<div *ngIf=\"!card\">\n    <form [formGroup]=\"creditForm\" card container=\".card-container\" [card-width]=\"410\" [messages]=\"messages\"\n        [placeholders]=\"placeholders\" [masks]=\"masks\" [formatting]=\"formatting\" [debug]=\"debug\">\n        <div formGroupName=\"payment\">\n            <div class=\"row\">\n                <div class=\"col-md-6 credit-card-hide\">\n                    <div class=\"card-container\">\n\n                    </div>\n                </div>\n                <div class=\"col-md-6\">\n                    <div class=\"content-group\">\n                        <div *ngIf=\"!companyNameSelected\" class=\"lable required\">Cardholder\u2019s name\n                        </div>\n                        <div *ngIf=\"companyNameSelected\" class=\"lable required\">Company name</div>\n                        <input class=\"field\" type=\"text\" card-name formControlName=\"cardName\" (keyup)=\"keypress()\">\n                        <div *ngIf=\"!companyNameSelected\" class=\"company-name-link\" (click)=\"companyNameClick()\">Or click here to use a company name</div>\n                        <div *ngIf=\"companyNameSelected\" class=\"company-name-link\" (click)=\"companyNameClick()\">Or click here to use your personal information</div>\n                    </div>\n                    <div class=\"content-group\">\n                        <div class=\"lable required\">Card number</div>\n                        <input class=\"field\" type=\"tel\" autocomplete=\"cc-number\" card-number\n                            formControlName=\"cardNumber\" maxlength=\"19\" placeholder=\"xxxx xxxx xxxx xxxx\"\n                            (keyup)=\"setCardType()\" [class.error_field]=\"!isCardNumberLength\">\n                        <img *ngIf=\"cardLogo\" class=\"icon-align\" src=\"{{cardImg}}\" (error)=\"defaultCard()\"\n                            alt=\"card name\">\n                    </div>\n                    <div class=\"row row-group\">\n                        <div class=\"col content-group\">\n                            <div class=\"lable required\">CVC</div>\n                            <input class=\"field\" type=\"password\" autocomplete=\"new-password\" pattern=\"[0-9]*\"\n                                inputmode=\"numeric\" card-cvc placeholder=\"xxx\" formControlName=\"cardCvc\"\n                                (keyup)=\"keypress()\">\n                        </div>\n                        <div class=\"col content-group\">\n                            <div class=\"lable required\">Exp date</div>\n                            <input class=\"field\" type=\"tel\" autocomplete=\"cc-exp\" card-expiry formControlName=\"expiry\"\n                                placeholder=\"MM / YY\" (keyup)=\"keypress()\">\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"content-group\" style=\"margin-bottom: 0;\">\n                <div class=\"lable required\">Email address</div>\n                <input class=\"field\" formControlName=\"email\" type=\"email\" (keyup)=\"keypress()\">\n                <div class=\"email-info\">This email will only be used to keep you updated about their payments</div>\n            </div>\n        </div>\n    </form>\n</div>", styles: [".content-group{margin:16px 0;font-size:14px}.content-group .vh{border-bottom:1px dashed var(--primaryBorderColor);margin:16px 0}.content-group select{cursor:pointer;appearance:none;background-color:#fff;border:1px solid var(--primaryBorderColor);border-radius:4px;padding:0 5px;color:var(--primaryTextColor)}.content-group select:focus-visible{outline:1px solid var(--inputHighlight)}.content-group .fa-angle-down{position:absolute;margin-left:-30px;margin-top:13px;color:var(--primaryTextColor)}.row-group{margin:-16px 0 0;grid-gap:24px;gap:24px}.row-group .col{padding:0}select{width:100%;height:40px}.icon-align{margin-top:4px;width:50px;position:absolute;margin-left:-54px}.lable{font-size:14px;color:var(--primaryTextColor);padding-bottom:8px}.field{width:100%;border:1px solid var(--primaryBorderColor);border-radius:4px;height:40px;padding:0 5px;color:var(--primaryTextColor)}.field:focus-visible{outline:1px solid var(--inputHighlight)}.error_field{border-color:var(--negativeButtonColour)}.error_field:focus-visible{outline:none}.company-name-link{padding-top:8px;color:var(--tertiaryButtonFontColour);cursor:pointer;max-width:-moz-fit-content;max-width:fit-content}.email-info{color:var(--positiveFoundation);margin-top:8px}.credit-card-hide{margin:auto}.card-container{margin-top:25px}.invalid-input{margin-top:5px;color:#b94a48}@media (max-width: 857px){.card-container{transform:scale(.9)}}@media (max-width: 768px){.card-container{transform:scale(.79)}.content-group{margin:12px 0}}@media (max-width: 578px){.row-group{grid-gap:16px;gap:16px}}@media (max-width: 425px){.card-container{margin-bottom:12px;margin-top:0;margin-left:0;transform:scale(.9)!important}}@media (max-width: 380px){.card-container{margin-top:0;margin-left:0;margin-bottom:0;transform:scale(.8)!important}}@media (max-width: 320px){.card-container{margin-left:-20px;margin-top:0;margin-bottom:0;transform:scale(.65)!important}}\n"], directives: [{ type: i1.NgSelectOption, selector: "option", inputs: ["ngValue", "value"] }, { type: i1.ɵNgSelectMultipleOption, selector: "option", inputs: ["ngValue", "value"] }, { type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i1.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i1.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i3.NgxCard, selector: "[card]", inputs: ["formatting", "debug", "messages", "placeholders", "container", "card-width", "masks"] }, { type: i1.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i1.FormGroupName, selector: "[formGroupName]", inputs: ["formGroupName"] }, { type: i1.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { type: i3.NgxCardNameTemplate, selector: "[card-name]" }, { type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i1.FormControlName, selector: "[formControlName]", inputs: ["disabled", "formControlName", "ngModel"], outputs: ["ngModelChange"] }, { type: i3.NgxCardNumberTemplate, selector: "[card-number]" }, { type: i1.MaxLengthValidator, selector: "[maxlength][formControlName],[maxlength][formControl],[maxlength][ngModel]", inputs: ["maxlength"] }, { type: i1.PatternValidator, selector: "[pattern][formControlName],[pattern][formControl],[pattern][ngModel]", inputs: ["pattern"] }, { type: i3.NgxCardCvcTemplate, selector: "[card-cvc]" }, { type: i3.NgxCardExpiryTemplate, selector: "[card-expiry]" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: PaymentCardDetailsComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'lib-payment-card-details',
                    templateUrl: './payment-card-details.component.html',
                    styleUrls: ['./payment-card-details.component.scss']
                }]
        }], ctorParameters: function () { return [{ type: i1.FormBuilder }]; }, propDecorators: { payEmitter: [{
                type: Output
            }], cardPaymentData: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF5bWVudC1jYXJkLWRldGFpbHMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGFyZW50cGF5bWVudC9zcmMvbGliL3BheW1lbnQtZGV0YWlscy9wYXltZW50LWNhcmQtZGV0YWlscy9wYXltZW50LWNhcmQtZGV0YWlscy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9wYXJlbnRwYXltZW50L3NyYy9saWIvcGF5bWVudC1kZXRhaWxzL3BheW1lbnQtY2FyZC1kZXRhaWxzL3BheW1lbnQtY2FyZC1kZXRhaWxzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0UsT0FBTyxFQUF1QyxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQzs7Ozs7QUFPMUQsTUFBTSxPQUFPLDJCQUEyQjtJQVN0QyxZQUNVLEVBQWU7UUFBZixPQUFFLEdBQUYsRUFBRSxDQUFhO1FBUmYsZUFBVSxHQUFxQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBR2pFLGdCQUFXLEdBQU0sRUFBRSxDQUFDO1FBQ3BCLGFBQVEsR0FBTSxFQUFFLENBQUM7UUFNakIsU0FBSSxHQUFTLEtBQUssQ0FBQztRQUVuQixjQUFTLEdBQVcsR0FBRyxDQUFDO1FBQ3hCLGFBQVEsR0FBUSxFQUFDLFNBQVMsRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUUseUJBQXlCO1FBQzFGLGlCQUFZLEdBQVEsRUFBQyxNQUFNLEVBQUUscUJBQXFCLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVB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U0FDdkMsQ0FBQTtRQUVELEtBQUksSUFBSSxHQUFHLElBQUksRUFBRSxFQUFFO1lBQ2YsSUFBRyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFO2dCQUN2QixPQUFPLEdBQUcsQ0FBQTthQUNYO1NBQ0o7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7O3lIQTlJWSwyQkFBMkI7NkdBQTNCLDJCQUEyQix1SkNUeEMsMDVIQWlFTTs0RkR4RE8sMkJBQTJCO2tCQUx2QyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSwwQkFBMEI7b0JBQ3BDLFdBQVcsRUFBRSx1Q0FBdUM7b0JBQ3BELFNBQVMsRUFBRSxDQUFDLHVDQUF1QyxDQUFDO2lCQUNyRDtrR0FHVyxVQUFVO3NCQUFuQixNQUFNO2dCQUtFLGVBQWU7c0JBQXZCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCAsSW5wdXQgLE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQnVpbGRlciwgRm9ybUNvbnRyb2wsIEZvcm1Hcm91cCwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IENyZWRpdENhcmRWYWxpZGF0b3JzIH0gZnJvbSAnYW5ndWxhci1jYy1saWJyYXJ5JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbGliLXBheW1lbnQtY2FyZC1kZXRhaWxzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BheW1lbnQtY2FyZC1kZXRhaWxzLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vcGF5bWVudC1jYXJkLWRldGFpbHMuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBQYXltZW50Q2FyZERldGFpbHNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIEBPdXRwdXQoKSBwYXlFbWl0dGVyOkV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIFxuICB1c2VyRGF0YTogYW55O1xuICBzdG9yZWRDYXJkczogYW55PVtdO1xuICBjYXJkVHlwZTogYW55PScnO1xuICBASW5wdXQoKSBjYXJkUGF5bWVudERhdGE6YW55O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyLFxuICApIHsgfVxuICBjYXJkOmJvb2xlYW49ZmFsc2U7XG4gIGNvbnRhaW5lcjogYW55O1xuICBjYXJkd2lkdGg6IE51bWJlciA9IDM1MDtcbiAgbWVzc2FnZXM6IGFueSA9IHt2YWxpZERhdGU6ICd2YWxpZFxcbmRhdGUnLCBtb250aFllYXI6ICdtbS95eSd9OyAgLy9TdHJpbmdzIGZvciB0cmFuc2xhdGlvblxuICBwbGFjZWhvbGRlcnM6IGFueSA9IHtudW1iZXI6ICfigKLigKLigKLigKIg4oCi4oCi4oCi4oCiIOKAouKAouKAouKAoiDigKLigKLigKLigKInLCBuYW1lOiAnRnVsbCBOYW1lJywgZXhwaXJ5OiAn4oCi4oCiL+KAouKAoicsIGN2YzogJ+KAouKAouKAoid9IC8vIFBsYWNlaG9sZGVycyBmb3IgcmVuZGVyZWQgZmllbGRzXG4gIG1hc2tzOiBhbnk7XG4gIGZvcm1hdHRpbmc6IGJvb2xlYW4gPSB0cnVlO1xuICBkZWJ1ZzogYm9vbGVhbiA9IHRydWU7IC8vIElmIHRydWUsIHdpbGwgbG9nIGhlbHBmdWwgbWVzc2FnZXMgZm9yIHNldHRpbmcgdXAgQ2FyZFxuICBjcmVkaXRGb3JtITogRm9ybUdyb3VwO1xuICBzdW1tYXJ5OiBhbnk7XG4gIGNvbXBhbnlOYW1lU2VsZWN0ZWQ6Ym9vbGVhbj1mYWxzZTtcbiAgaXNDYXJkTnVtYmVyTGVuZ3RoOiBib29sZWFuPXRydWU7XG4gIGNhcmRMb2dvOiBhbnk9Jyc7XG4gIGNhcmRJbWc6IHN0cmluZyA9IFwiXCI7XG5cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnBheUVtaXR0ZXIuZW1pdCh0cnVlKTtcbiAgfVxuXG4gIGRyb3Bkb3duKHZhbDphbnkpe1xuICAgIHRoaXMuY2FyZFR5cGU9ZmFsc2U7XG4gICAgdGhpcy5wYXlFbWl0dGVyLmVtaXQoZmFsc2UpO1xuICAgIGlmKHZhbCA9PSAnU2V0IHVwIG5ldyBkZWJpdCBvciBjcmVkaXQgY2FyZCcpe1xuICAgICAgICB0aGlzLmNhcmQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5idWlsZENyZWRpdEZvcm1zKClcbiAgICB9XG4gICAgLy8gdGhpcy50cmFuc2xhdGUuZ2V0KFwiVXNlIGV4aXN0aW5nIGNyZWRpdCBjYXJkXCIpLnN1YnNjcmliZSh0cmFuc2xhdGlvbnMgPT4ge1xuICAgIC8vICAgaWYodmFsLnZhbHVlPT0gdHJhbnNsYXRpb25zKXtcbiAgICAvLyAgICAgdGhpcy5jYXJkPXRydWVcbiAgICAvLyAgICAgaWYodGhpcy5zdG9yZWRDYXJkcy5sZW5ndGggPT0gMSl7XG4gICAgLy8gICAgICAgdGhpcy5jYXJkU2VsZWN0ZWQodGhpcy5zdG9yZWRDYXJkc1swXS5pZCwndHMnKVxuICAgIC8vICAgICB9XG4gICAgLy8gICB9XG4gICAgLy8gICBlbHNle1xuICAgIC8vICAgICB0aGlzLmNhcmQ9ZmFsc2VcbiAgICAvLyAgICAgdGhpcy5idWlsZENyZWRpdEZvcm1zKClcbiAgICAvLyAgIH1cbiAgICAvLyB9KVxuXG4gIH1cbiBcbiAgYnVpbGRDcmVkaXRGb3Jtcygpe1xuICAgIGxldCBkYXRlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKTsgIFxuICAgIHRoaXMuY3JlZGl0Rm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgcGF5bWVudDogdGhpcy5mYi5ncm91cCh7XG4gICAgICAnYW1vdW50JzogWywgXSxcbiAgICAgICdjYXJkQ2hhcmdlJzogW3RoaXMuY2FyZFBheW1lbnREYXRhLmNhcmRDaGFyZ2VzWycnXSBdLC8vaW5kZXggVUkgbmVlZGVkXG4gICAgICAnY2FyZE5hbWUnOiBbdGhpcy5jYXJkUGF5bWVudERhdGEuY3VzdG9tZXJEZXRhaWxzLmN1c3RvbWVyTmFtZSwgW1ZhbGlkYXRvcnMucmVxdWlyZWRdIF0sXG4gICAgICAnY2FyZE51bWJlcic6IFsnJywgW1ZhbGlkYXRvcnMucmVxdWlyZWQsIENyZWRpdENhcmRWYWxpZGF0b3JzLnZhbGlkYXRlQ0NOdW1iZXJdXSxcbiAgICAgICdjYXJkQ3ZjJzogWycnLCBbVmFsaWRhdG9ycy5yZXF1aXJlZCwgVmFsaWRhdG9ycy5taW5MZW5ndGgoMyksIFZhbGlkYXRvcnMubWF4TGVuZ3RoKDQpXV0sXG4gICAgICAncGF5bWVudERhdGUnOiBbZGF0ZSwgXSxcbiAgICAgICdkZXNjcmlwdGlvbic6IFtcIkludm9pY2Ugbm8gOiBcIit0aGlzLmNhcmRQYXltZW50RGF0YS5pbnZvaWNlRGV0YWlscy5pbnZvaWNlTnVtYmVyXSxcbiAgICAgICdpc3BvcnRhbCc6IFt0cnVlLCBdLFxuICAgICAgJ3JlZmVyZW5jZSc6IFsnSW52b2ljZSBubyA6ICcrdGhpcy5jYXJkUGF5bWVudERhdGEuaW52b2ljZURldGFpbHMuaW52b2ljZU51bWJlciwgXSxcbiAgICAgIC8vICdpbnZvaWNlcyc6W1t0aGlzLmNhcmRQYXltZW50RGF0YS5pbnZvaWNlRGV0YWlscy5pbnZvaWNlTnVtYmVyXV0sXG4gICAgICAnZW1haWwnOiBbdGhpcy5jYXJkUGF5bWVudERhdGEuY3VzdG9tZXJEZXRhaWxzLmVtYWlsSWQsW1ZhbGlkYXRvcnMucmVxdWlyZWQsIFZhbGlkYXRvcnMuZW1haWxdXSxcbiAgICAgIC8vICdzdG9yZWRDYXJkJzogWzAsIF0sXG4gICAgICAnZXhwaXJ5JzogWycnLCBbVmFsaWRhdG9ycy5yZXF1aXJlZCwgQ3JlZGl0Q2FyZFZhbGlkYXRvcnMudmFsaWRhdGVFeHBEYXRlXV0sXG4gICAgICAvLyAnc2F2ZUNhcmQnOiBbdHJ1ZSwgXSxcblxuICAgICAgXCJwYXltZW50TWV0aG9kXCI6W3RoaXMuY2FyZFBheW1lbnREYXRhLmNhcmRDaGFyZ2VzWycnXV0sXG4gICAgICBcImRvbnRTZW5kVG9BY2NvdW50c1wiOlsnJ10sXG4gICAgICAvLyBcImludm9pY2VzXCI6W3snaW52b2ljZUlkJzonMScsJ2Ftb3VudCc6JzEnLCAnYXVkaXRTZW5kdG9hY2NvdW50aW5nc3lzdGVtc2lkOicxJ30sXVxuICAgICAgfSlcblxuICAgIH0pO1xuICAgIHRoaXMucGxhY2Vob2xkZXJzID0ge25hbWU6IHRoaXMuY2FyZFBheW1lbnREYXRhLmN1c3RvbWVyRGV0YWlscy5jdXN0b21lck5hbWU/dGhpcy5jYXJkUGF5bWVudERhdGEuY3VzdG9tZXJEZXRhaWxzLmN1c3RvbWVyTmFtZTonRnVsbCBOYW1lJ307XG4gIH1cblxuICBjb21wYW55TmFtZUNsaWNrKCl7XG4gICAgdGhpcy5jb21wYW55TmFtZVNlbGVjdGVkPSF0aGlzLmNvbXBhbnlOYW1lU2VsZWN0ZWQ7XG4gICAgdGhpcy5jcmVkaXRGb3JtLnBhdGNoVmFsdWUoeydwYXltZW50Jzp7J2NhcmROYW1lJzonJ319KTtcbiAgfVxuICBrZXlwcmVzcygpe1xuICAgIHRoaXMucGF5RW1pdHRlci5lbWl0KHRoaXMuY3JlZGl0Rm9ybSk7XG4gIH1cbiAgc2V0Q2FyZFR5cGUoKXtcbiAgICB0aGlzLmNhcmRMb2dvPXRoaXMuZGV0ZWN0Q2FyZFR5cGUodGhpcy5jcmVkaXRGb3JtLnZhbHVlLnBheW1lbnQuY2FyZE51bWJlci5yZXBsYWNlKC9cXHMvZywgXCJcIikpXG4gICAgdmFyIGNhcmRTdGF0dXMgPSB0aGlzLmNyZWRpdEZvcm0uZ2V0KCdwYXltZW50LmNhcmROdW1iZXInKVxuICAgIGlmKHRoaXMuaXNDYXJkTnVtYmVyTGVuZ3RoICYmIGNhcmRTdGF0dXM/LnN0YXR1cyA9PSBcIklOVkFMSURcIil0aGlzLmlzQ2FyZE51bWJlckxlbmd0aD1mYWxzZTtcbiAgICBpZighdGhpcy5pc0NhcmROdW1iZXJMZW5ndGggJiYgY2FyZFN0YXR1cz8uc3RhdHVzID09IFwiVkFMSURcIil0aGlzLmlzQ2FyZE51bWJlckxlbmd0aD10cnVlO1xuICAgIHRoaXMucGF5RW1pdHRlci5lbWl0KHRoaXMuY3JlZGl0Rm9ybSk7XG4gICAgdGhpcy5jYXJkSW1nID0gXCJhc3NldHMvcGF5bWVudFR5cGUvXCIrdGhpcy5jYXJkTG9nbytcIi5zdmdcIlxuICB9XG4gIGRlZmF1bHRDYXJkKCl7XG4gICAgdGhpcy5jYXJkSW1nID0gXCJhc3NldHMvcGF5bWVudFR5cGUvY2FyZC5zdmdcIlxuICB9XG4gIGNhcmRTZWxlY3RlZCh2YWw6YW55LGZyb206c3RyaW5nKXtcbiAgICB2YWw9IGZyb209PSdodG1sJyA/dmFsLnZhbHVlOnZhbDtcbiAgICB2YXIgc3RvcmVkQ2FyZCA9IHRoaXMuc3RvcmVkQ2FyZHMuZmluZCgoeDphbnkpID0+IHguaWQgPT0gdmFsKS5kZXNjcmlwdGlvblxuICAgIHRoaXMuY2FyZFR5cGU9c3RvcmVkQ2FyZC5zdWJzdHJpbmcoMCwgc3RvcmVkQ2FyZC5pbmRleE9mKCdlbmRpbmcnKS0xKVxuICAgIGxldCBkYXRlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKTsgIFxuICAgIHRoaXMuY3JlZGl0Rm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgICAncGF5bWVudERhdGUnIDogW2RhdGUsIFtWYWxpZGF0b3JzLnJlcXVpcmVkXSBdLFxuICAgICAgICAnZGVzY3JpcHRpb24nIDogW1wiSW52b2ljZSBubyA6ICNcIit0aGlzLmNhcmRQYXltZW50RGF0YS5pbnZvaWNlRGV0YWlscy5pbnZvaWNlTnVtYmVyXSxcbiAgICAgICAgJ3JlZmVyZW5jZScgOiBbJ0ludm9pY2Ugbm8gOiAjJyt0aGlzLmNhcmRQYXltZW50RGF0YS5pbnZvaWNlRGV0YWlscy5pbnZvaWNlTnVtYmVyLCBdLFxuICAgICAgICAncGF5bWVudE1ldGhvZCcgOiBbdGhpcy5jYXJkUGF5bWVudERhdGEuY2FyZENoYXJnZXNbdGhpcy5jYXJkUGF5bWVudERhdGEuY2FyZENoYXJnZXMubGVuZ3RoLTFdLnBheW1lbnRNZXRob2RJZCwgW1ZhbGlkYXRvcnMucmVxdWlyZWRdXSxcbiAgICAgICAgJ3N0b3JlZENhcmQnIDogW3ZhbCwgW1ZhbGlkYXRvcnMucmVxdWlyZWRdXSxcbiAgICAgICAgJ2NhcmROYW1lJyA6IFt0aGlzLmNhcmRQYXltZW50RGF0YS5jdXN0b21lckRldGFpbHMuY3VzdG9tZXJOYW1lLCBbVmFsaWRhdG9ycy5yZXF1aXJlZF1dLFxuICAgICAgICAnYW1vdW50JyA6IFtdLFxuICAgICAgICAnY2FyZENoYXJnZScgOiBbdGhpcy5jYXJkUGF5bWVudERhdGEuY2FyZENoYXJnZXNbdGhpcy5jYXJkUGF5bWVudERhdGEuY2FyZENoYXJnZXMubGVuZ3RoLTFdLmNoYXJnZSwgXSxcbiAgICAgICAgJ2lzUG9ydGFsJyA6IFt0cnVlXSxcbiAgICAgIH0pO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMucGF5RW1pdHRlci5lbWl0KHRoaXMuY3JlZGl0Rm9ybSk7XG4gICAgICB9LCAxMDApO1xufVxuXG5kZXRlY3RDYXJkVHlwZShudW1iZXI6bnVtYmVyKSB7XG4gIHZhciByZSA6YW55ID0ge1xuICAgICAgZWxlY3Ryb246IC9eKDQwMjZ8NDE3NTAwfDQ0MDV8NDUwOHw0ODQ0fDQ5MTN8NDkxNylcXGQrJC8sXG4gICAgICBtYWVzdHJvOiAvXig1MDE4fDUwMjB8NTAzOHw1NjEyfDU4OTN8NjMwNHw2NzU5fDY3NjF8Njc2Mnw2NzYzfDA2MDR8NjM5MClcXGQrJC8sXG4gICAgICBkYW5rb3J0OiAvXig1MDE5KVxcZCskLyxcbiAgICAgIGludGVycGF5bWVudDogL14oNjM2KVxcZCskLyxcbiAgICAgIHVuaW9ucGF5OiAvXig2Mnw4OClcXGQrJC8sXG4gICAgICAnVmlzYSc6IC9eNFswLTldezEyfSg/OlswLTldezN9KT8kLyxcbiAgICAgICdNYXN0ZXJDYXJkJzogL141WzEtNV1bMC05XXsxNH0kLyxcbiAgICAgICdBbWVyaWNhbiBFeHByZXNzJzogL14zWzQ3XVswLTldezEzfSQvLFxuICAgICAgZGluZXJzOiAvXjMoPzowWzAtNV18WzY4XVswLTldKVswLTldezExfSQvLFxuICAgICAgZGlzY292ZXI6IC9eNig/OjAxMXw1WzAtOV17Mn0pWzAtOV17MTJ9JC8sXG4gICAgICBqY2I6IC9eKD86MjEzMXwxODAwfDM1XFxkezN9KVxcZHsxMX0kL1xuICB9XG5cbiAgZm9yKHZhciBrZXkgaW4gcmUpIHtcbiAgICAgIGlmKHJlW2tleV0udGVzdChudW1iZXIpKSB7XG4gICAgICAgIHJldHVybiBrZXlcbiAgICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cblxufVxuIiwiPGRpdiBjbGFzcz1cImNvbnRlbnQtZ3JvdXBcIiBzdHlsZT1cIm1hcmdpbi1ib3R0b206LTE2cHhcIj5cbiAgICA8c2VsZWN0IChjaGFuZ2UpPVwiZHJvcGRvd24oJGV2ZW50LnRhcmdldClcIj5cbiAgICAgICAgPG9wdGlvbj5Vc2UgZXhpc3RpbmcgY3JlZGl0IGNhcmQ8L29wdGlvbj5cbiAgICAgICAgPG9wdGlvbj5TZXQgdXAgbmV3IGRlYml0IG9yIGNyZWRpdCBjYXJkPC9vcHRpb24+XG4gICAgPC9zZWxlY3Q+PGkgY2xhc3M9XCJmYS1zb2xpZCBmYS1hbmdsZS1kb3duXCI+PC9pPlxuICAgIDxkaXYgY2xhc3M9XCJ2aFwiPjwvZGl2PlxuPC9kaXY+XG5cbjxkaXYgKm5nSWY9XCJjYXJkXCI+XG4gICAgPGRpdiBjbGFzcz1cImNvbnRlbnQtZ3JvdXBcIiBzdHlsZT1cIm1hcmdpbi10b3A6MzJweDttYXJnaW4tYm90dG9tOiAwO1wiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwibGFibGVcIj5TZWxlY3QgY2FyZDwvZGl2PlxuICAgICAgICA8c2VsZWN0IChjaGFuZ2UpPVwiY2FyZFNlbGVjdGVkKCRldmVudC50YXJnZXQsJ2h0bWwnKVwiPlxuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIlwiIGRpc2FibGVkIHNlbGVjdGVkIGhpZGRlbj5QbGVhc2Ugc2VsZWN0PC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PjxpIGNsYXNzPVwiZmEtc29saWQgZmEtYW5nbGUtZG93blwiPjwvaT5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuPGRpdiAqbmdJZj1cIiFjYXJkXCI+XG4gICAgPGZvcm0gW2Zvcm1Hcm91cF09XCJjcmVkaXRGb3JtXCIgY2FyZCBjb250YWluZXI9XCIuY2FyZC1jb250YWluZXJcIiBbY2FyZC13aWR0aF09XCI0MTBcIiBbbWVzc2FnZXNdPVwibWVzc2FnZXNcIlxuICAgICAgICBbcGxhY2Vob2xkZXJzXT1cInBsYWNlaG9sZGVyc1wiIFttYXNrc109XCJtYXNrc1wiIFtmb3JtYXR0aW5nXT1cImZvcm1hdHRpbmdcIiBbZGVidWddPVwiZGVidWdcIj5cbiAgICAgICAgPGRpdiBmb3JtR3JvdXBOYW1lPVwicGF5bWVudFwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNiBjcmVkaXQtY2FyZC1oaWRlXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkLWNvbnRhaW5lclwiPlxuXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNlwiPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGVudC1ncm91cFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiAqbmdJZj1cIiFjb21wYW55TmFtZVNlbGVjdGVkXCIgY2xhc3M9XCJsYWJsZSByZXF1aXJlZFwiPkNhcmRob2xkZXLigJlzIG5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiAqbmdJZj1cImNvbXBhbnlOYW1lU2VsZWN0ZWRcIiBjbGFzcz1cImxhYmxlIHJlcXVpcmVkXCI+Q29tcGFueSBuYW1lPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9XCJmaWVsZFwiIHR5cGU9XCJ0ZXh0XCIgY2FyZC1uYW1lIGZvcm1Db250cm9sTmFtZT1cImNhcmROYW1lXCIgKGtleXVwKT1cImtleXByZXNzKClcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgKm5nSWY9XCIhY29tcGFueU5hbWVTZWxlY3RlZFwiIGNsYXNzPVwiY29tcGFueS1uYW1lLWxpbmtcIiAoY2xpY2spPVwiY29tcGFueU5hbWVDbGljaygpXCI+T3IgY2xpY2sgaGVyZSB0byB1c2UgYSBjb21wYW55IG5hbWU8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgKm5nSWY9XCJjb21wYW55TmFtZVNlbGVjdGVkXCIgY2xhc3M9XCJjb21wYW55LW5hbWUtbGlua1wiIChjbGljayk9XCJjb21wYW55TmFtZUNsaWNrKClcIj5PciBjbGljayBoZXJlIHRvIHVzZSB5b3VyIHBlcnNvbmFsIGluZm9ybWF0aW9uPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGVudC1ncm91cFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImxhYmxlIHJlcXVpcmVkXCI+Q2FyZCBudW1iZXI8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz1cImZpZWxkXCIgdHlwZT1cInRlbFwiIGF1dG9jb21wbGV0ZT1cImNjLW51bWJlclwiIGNhcmQtbnVtYmVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVwiY2FyZE51bWJlclwiIG1heGxlbmd0aD1cIjE5XCIgcGxhY2Vob2xkZXI9XCJ4eHh4IHh4eHggeHh4eCB4eHh4XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoa2V5dXApPVwic2V0Q2FyZFR5cGUoKVwiIFtjbGFzcy5lcnJvcl9maWVsZF09XCIhaXNDYXJkTnVtYmVyTGVuZ3RoXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aW1nICpuZ0lmPVwiY2FyZExvZ29cIiBjbGFzcz1cImljb24tYWxpZ25cIiBzcmM9XCJ7e2NhcmRJbWd9fVwiIChlcnJvcik9XCJkZWZhdWx0Q2FyZCgpXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHQ9XCJjYXJkIG5hbWVcIj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyb3cgcm93LWdyb3VwXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sIGNvbnRlbnQtZ3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibGFibGUgcmVxdWlyZWRcIj5DVkM8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9XCJmaWVsZFwiIHR5cGU9XCJwYXNzd29yZFwiIGF1dG9jb21wbGV0ZT1cIm5ldy1wYXNzd29yZFwiIHBhdHRlcm49XCJbMC05XSpcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dG1vZGU9XCJudW1lcmljXCIgY2FyZC1jdmMgcGxhY2Vob2xkZXI9XCJ4eHhcIiBmb3JtQ29udHJvbE5hbWU9XCJjYXJkQ3ZjXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGtleXVwKT1cImtleXByZXNzKClcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbCBjb250ZW50LWdyb3VwXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImxhYmxlIHJlcXVpcmVkXCI+RXhwIGRhdGU8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9XCJmaWVsZFwiIHR5cGU9XCJ0ZWxcIiBhdXRvY29tcGxldGU9XCJjYy1leHBcIiBjYXJkLWV4cGlyeSBmb3JtQ29udHJvbE5hbWU9XCJleHBpcnlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIk1NIC8gWVlcIiAoa2V5dXApPVwia2V5cHJlc3MoKVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGVudC1ncm91cFwiIHN0eWxlPVwibWFyZ2luLWJvdHRvbTogMDtcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibGFibGUgcmVxdWlyZWRcIj5FbWFpbCBhZGRyZXNzPC9kaXY+XG4gICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPVwiZmllbGRcIiBmb3JtQ29udHJvbE5hbWU9XCJlbWFpbFwiIHR5cGU9XCJlbWFpbFwiIChrZXl1cCk9XCJrZXlwcmVzcygpXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImVtYWlsLWluZm9cIj5UaGlzIGVtYWlsIHdpbGwgb25seSBiZSB1c2VkIHRvIGtlZXAgeW91IHVwZGF0ZWQgYWJvdXQgdGhlaXIgcGF5bWVudHM8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Zvcm0+XG48L2Rpdj4iXX0=